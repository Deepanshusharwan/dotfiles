(()=>{var __webpack_modules__={"./node_modules/defuddle/dist/index.js":function(module){var e;"undefined"!=typeof self&&self,e=()=>(()=>{"use strict";var t={0:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.mathRules=e.createCleanMathEl=void 0;const n=r(282);e.createCleanMathEl=(t,e,r,n)=>{const o=t.createElement("math");if(o.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),o.setAttribute("display",n?"block":"inline"),o.setAttribute("data-latex",r||""),null==e?void 0:e.mathml){const r=t.createElement("div");r.innerHTML=e.mathml;const n=r.querySelector("math");n&&(o.innerHTML=n.innerHTML)}else r&&(o.textContent=r);return o},e.mathRules=[{selector:n.mathSelectors,element:"math",transform:(t,r)=>{if(!function(t){return"classList"in t&&"getAttribute"in t&&"querySelector"in t}(t))return t;const o=(0,n.getMathMLFromElement)(t),i=(0,n.getBasicLatexFromElement)(t),a=(0,n.isBlockDisplay)(t),s=(0,e.createCleanMathEl)(r,o,i,a);return t.parentElement&&t.parentElement.querySelectorAll('\n\t\t\t\t\t/* MathJax scripts and previews */\n\t\t\t\t\tscript[type^="math/"],\n\t\t\t\t\t.MathJax_Preview,\n\n\t\t\t\t\t/* External math library scripts */\n\t\t\t\t\tscript[type="text/javascript"][src*="mathjax"],\n\t\t\t\t\tscript[type="text/javascript"][src*="katex"]\n\t\t\t\t').forEach((t=>t.remove())),s}}]},20:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GrokExtractor=void 0;const n=r(181);class o extends n.ConversationExtractor{constructor(t,e){super(t,e),this.messageContainerSelector=".relative.group.flex.flex-col.justify-center.w-full",this.messageBubbles=t.querySelectorAll(this.messageContainerSelector),this.footnotes=[],this.footnoteCounter=0}canExtract(){return!!this.messageBubbles&&this.messageBubbles.length>0}extractMessages(){const t=[];return this.footnotes=[],this.footnoteCounter=0,this.messageBubbles&&0!==this.messageBubbles.length?(this.messageBubbles.forEach((e=>{var r;const n=e.classList.contains("items-end"),o=e.classList.contains("items-start");if(!n&&!o)return;const i=e.querySelector(".message-bubble");if(!i)return;let a="",s="",l="";if(n)a=i.textContent||"",s="user",l="You";else if(o){s="assistant",l="Grok";const t=i.cloneNode(!0);null===(r=t.querySelector(".relative.border.border-border-l1.bg-surface-base"))||void 0===r||r.remove(),a=t.innerHTML,a=this.processFootnotes(a)}a.trim()&&t.push({author:l,content:a.trim(),metadata:{role:s}})})),t):t}getFootnotes(){return this.footnotes}getMetadata(){var t;const e=this.getTitle(),r=(null===(t=this.messageBubbles)||void 0===t?void 0:t.length)||0;return{title:e,site:"Grok",url:this.url,messageCount:r,description:`Grok conversation with ${r} messages`}}getTitle(){var t,e;const r=null===(t=this.document.title)||void 0===t?void 0:t.trim();if(r&&"Grok"!==r&&!r.startsWith("Grok by "))return r.replace(/\s-\s*Grok$/,"").trim();const n=this.document.querySelector(`${this.messageContainerSelector}.items-end`);if(n){const t=n.querySelector(".message-bubble");if(t){const r=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"";return r.length>50?r.slice(0,50)+"...":r}}return"Grok Conversation"}processFootnotes(t){return t.replace(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"[^>]*>(.*?)<\/a>/gi,((t,e,r)=>{if(!e||e.startsWith("#")||!e.match(/^https?:\/\//i))return t;let n;if(this.footnotes.find((t=>t.url===e)))n=this.footnotes.findIndex((t=>t.url===e))+1;else{this.footnoteCounter++,n=this.footnoteCounter;let t=e;try{const r=new URL(e).hostname.replace(/^www\./,"");t=`<a href="${e}" target="_blank" rel="noopener noreferrer">${r}</a>`}catch(r){t=`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`,console.warn(`GrokExtractor: Could not parse URL for footnote: ${e}`)}this.footnotes.push({url:e,text:t})}return`${r}<sup id="fnref:${n}" class="footnote-ref"><a href="#fn:${n}" class="footnote-link">${n}</a></sup>`}))}}e.GrokExtractor=o},181:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationExtractor=void 0;const n=r(279),o=r(628);class i extends n.BaseExtractor{getFootnotes(){return[]}extract(){var t;const e=this.extractMessages(),r=this.getMetadata(),n=this.getFootnotes(),i=this.createContentHtml(e,n),a=document.implementation.createHTMLDocument(),s=a.createElement("article");s.innerHTML=i,a.body.appendChild(s);const l=new o.Defuddle(a).parse(),c=l.content;return{content:c,contentHtml:c,extractedContent:{messageCount:e.length.toString()},variables:{title:r.title||"Conversation",site:r.site,description:r.description||`${r.site} conversation with ${e.length} messages`,wordCount:(null===(t=l.wordCount)||void 0===t?void 0:t.toString())||""}}}createContentHtml(t,e){return`${t.map(((e,r)=>{const n=e.timestamp?`<div class="message-timestamp">${e.timestamp}</div>`:"",o=/<p[^>]*>[\s\S]*?<\/p>/i.test(e.content)?e.content:`<p>${e.content}</p>`,i=e.metadata?Object.entries(e.metadata).map((([t,e])=>`data-${t}="${e}"`)).join(" "):"";return`\n\t\t\t<div class="message message-${e.author.toLowerCase()}" ${i}>\n\t\t\t\t<div class="message-header">\n\t\t\t\t\t<p class="message-author"><strong>${e.author}</strong></p>\n\t\t\t\t\t${n}\n\t\t\t\t</div>\n\t\t\t\t<div class="message-content">\n\t\t\t\t\t${o}\n\t\t\t\t</div>\n\t\t\t</div>${r<t.length-1?"\n<hr>":""}`})).join("\n").trim()}\n${e.length>0?`\n\t\t\t<div id="footnotes">\n\t\t\t\t<ol>\n\t\t\t\t\t${e.map(((t,e)=>`\n\t\t\t\t\t\t<li class="footnote" id="fn:${e+1}">\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<a href="${t.url}" target="_blank">${t.text}</a>&nbsp;<a href="#fnref:${e+1}" class="footnote-backref">\u21a9</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`)).join("")}\n\t\t\t\t</ol>\n\t\t\t</div>`:""}`.trim()}}e.ConversationExtractor=i},248:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TwitterExtractor=void 0;const n=r(279);class o extends n.BaseExtractor{constructor(t,e){var r;super(t,e),this.mainTweet=null,this.threadTweets=[];const n=t.querySelector('[aria-label="Timeline: Conversation"]');if(!n){const e=t.querySelector('article[data-testid="tweet"]');return void(e&&(this.mainTweet=e))}const o=Array.from(n.querySelectorAll('article[data-testid="tweet"]')),i=null===(r=n.querySelector("section, h2"))||void 0===r?void 0:r.parentElement;i&&o.forEach(((t,e)=>{if(i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)return o.splice(e),!1})),this.mainTweet=o[0]||null,this.threadTweets=o.slice(1)}canExtract(){return!!this.mainTweet}extract(){const t=this.extractTweet(this.mainTweet),e=this.threadTweets.map((t=>this.extractTweet(t))).join("\n<hr>\n"),r=`\n\t\t\t<div class="tweet-thread">\n\t\t\t\t<div class="main-tweet">\n\t\t\t\t\t${t}\n\t\t\t\t</div>\n\t\t\t\t${e?`\n\t\t\t\t\t<hr>\n\t\t\t\t\t<div class="thread-tweets">\n\t\t\t\t\t\t${e}\n\t\t\t\t\t</div>\n\t\t\t\t`:""}\n\t\t\t</div>\n\t\t`.trim(),n=this.getTweetId(),o=this.getTweetAuthor();return{content:r,contentHtml:r,extractedContent:{tweetId:n,tweetAuthor:o},variables:{title:`Thread by ${o}`,author:o,site:"X (Twitter)",description:this.createDescription(this.mainTweet)}}}formatTweetText(t){if(!t)return"";const e=document.createElement("div");return e.innerHTML=t,e.querySelectorAll("a").forEach((t=>{var e;const r=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"";t.replaceWith(r)})),e.querySelectorAll("span, div").forEach((t=>{t.replaceWith(...Array.from(t.childNodes))})),e.innerHTML.split("\n").map((t=>t.trim())).filter((t=>t)).map((t=>`<p>${t}</p>`)).join("\n")}extractTweet(t){var e,r,n;if(!t)return"";const o=t.cloneNode(!0);o.querySelectorAll('img[src*="/emoji/"]').forEach((t=>{if("img"===t.tagName.toLowerCase()&&t.getAttribute("alt")){const e=t.getAttribute("alt");e&&t.replaceWith(e)}}));const i=(null===(e=o.querySelector('[data-testid="tweetText"]'))||void 0===e?void 0:e.innerHTML)||"",a=this.formatTweetText(i),s=this.extractImages(t),l=this.extractUserInfo(t),c=null===(n=null===(r=t.querySelector('[aria-labelledby*="id__"]'))||void 0===r?void 0:r.querySelector('[data-testid="User-Name"]'))||void 0===n?void 0:n.closest('[aria-labelledby*="id__"]'),d=c?this.extractTweet(c):"";return`\n\t\t\t<div class="tweet">\n\t\t\t\t<div class="tweet-header">\n\t\t\t\t\t<span class="tweet-author"><strong>${l.fullName}</strong> <span class="tweet-handle">${l.handle}</span></span>\n\t\t\t\t\t${l.date?`<a href="${l.permalink}" class="tweet-date">${l.date}</a>`:""}\n\t\t\t\t</div>\n\t\t\t\t${a?`<div class="tweet-text">${a}</div>`:""}\n\t\t\t\t${s.length?`\n\t\t\t\t\t<div class="tweet-media">\n\t\t\t\t\t\t${s.join("\n")}\n\t\t\t\t\t</div>\n\t\t\t\t`:""}\n\t\t\t\t${d?`\n\t\t\t\t\t<blockquote class="quoted-tweet">\n\t\t\t\t\t\t${d}\n\t\t\t\t\t</blockquote>\n\t\t\t\t`:""}\n\t\t\t</div>\n\t\t`.trim()}extractUserInfo(t){var e,r,n,o,i,a,s,l,c;const d=t.querySelector('[data-testid="User-Name"]');if(!d)return{fullName:"",handle:"",date:"",permalink:""};const u=d.querySelectorAll("a");let m=(null===(r=null===(e=null==u?void 0:u[0])||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim())||"",h=(null===(o=null===(n=null==u?void 0:u[1])||void 0===n?void 0:n.textContent)||void 0===o?void 0:o.trim())||"";m&&h||(m=(null===(a=null===(i=d.querySelector('span[style*="color: rgb(15, 20, 25)"] span'))||void 0===i?void 0:i.textContent)||void 0===a?void 0:a.trim())||"",h=(null===(l=null===(s=d.querySelector('span[style*="color: rgb(83, 100, 113)"]'))||void 0===s?void 0:s.textContent)||void 0===l?void 0:l.trim())||"");const p=t.querySelector("time"),g=(null==p?void 0:p.getAttribute("datetime"))||"";return{fullName:m,handle:h,date:g?new Date(g).toISOString().split("T")[0]:"",permalink:(null===(c=null==p?void 0:p.closest("a"))||void 0===c?void 0:c.href)||""}}extractImages(t){var e,r;const n=['[data-testid="tweetPhoto"]','[data-testid="tweet-image"]','img[src*="media"]'],o=[],i=null===(r=null===(e=t.querySelector('[aria-labelledby*="id__"]'))||void 0===e?void 0:e.querySelector('[data-testid="User-Name"]'))||void 0===r?void 0:r.closest('[aria-labelledby*="id__"]');for(const e of n)t.querySelectorAll(e).forEach((t=>{var e,r;if(!(null==i?void 0:i.contains(t))&&"img"===t.tagName.toLowerCase()&&t.getAttribute("alt")){const n=(null===(e=t.getAttribute("src"))||void 0===e?void 0:e.replace(/&name=\w+$/,"&name=large"))||"",i=(null===(r=t.getAttribute("alt"))||void 0===r?void 0:r.replace(/\s+/g," ").trim())||"";o.push(`<img src="${n}" alt="${i}" />`)}}));return o}getTweetId(){const t=this.url.match(/status\/(\d+)/);return(null==t?void 0:t[1])||""}getTweetAuthor(){var t,e,r;const n=null===(t=this.mainTweet)||void 0===t?void 0:t.querySelector('[data-testid="User-Name"]'),o=null==n?void 0:n.querySelectorAll("a"),i=(null===(r=null===(e=null==o?void 0:o[1])||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim())||"";return i.startsWith("@")?i:`@${i}`}createDescription(t){var e;return t?((null===(e=t.querySelector('[data-testid="tweetText"]'))||void 0===e?void 0:e.textContent)||"").trim().slice(0,140).replace(/\s+/g," "):""}}e.TwitterExtractor=o},258:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.YoutubeExtractor=void 0;const n=r(279);class o extends n.BaseExtractor{constructor(t,e,r){super(t,e,r),this.videoElement=t.querySelector("video"),this.schemaOrgData=r}canExtract(){return!0}extract(){const t=this.getVideoData(),e=t.description||"",r=this.formatDescription(e),n=`<iframe width="560" height="315" src="https://www.youtube.com/embed/${this.getVideoId()}?si=_m0qv33lAuJFoGNh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><br>${r}`;return{content:n,contentHtml:n,extractedContent:{videoId:this.getVideoId(),author:t.author||""},variables:{title:t.name||"",author:t.author||"",site:"YouTube",image:Array.isArray(t.thumbnailUrl)&&t.thumbnailUrl[0]||"",published:t.uploadDate,description:e.slice(0,200).trim()}}}formatDescription(t){return`<p>${t.replace(/\n/g,"<br>")}</p>`}getVideoData(){return this.schemaOrgData&&(Array.isArray(this.schemaOrgData)?this.schemaOrgData.find((t=>"VideoObject"===t["@type"])):"VideoObject"===this.schemaOrgData["@type"]?this.schemaOrgData:null)||{}}getVideoId(){return new URLSearchParams(new URL(this.url).search).get("v")||""}}e.YoutubeExtractor=o},279:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseExtractor=void 0,e.BaseExtractor=class{constructor(t,e,r){this.document=t,this.url=e,this.schemaOrgData=r}}},282:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.mathSelectors=e.isBlockDisplay=e.getBasicLatexFromElement=e.getMathMLFromElement=void 0,e.getMathMLFromElement=t=>{if("math"===t.tagName.toLowerCase()){const e="block"===t.getAttribute("display");return{mathml:t.outerHTML,latex:t.getAttribute("alttext")||null,isBlock:e}}const e=t.getAttribute("data-mathml");if(e){const t=document.createElement("div");t.innerHTML=e;const r=t.querySelector("math");if(r){const t="block"===r.getAttribute("display");return{mathml:r.outerHTML,latex:r.getAttribute("alttext")||null,isBlock:t}}}const r=t.querySelector(".MJX_Assistive_MathML, mjx-assistive-mml");if(r){const t=r.querySelector("math");if(t){const e=t.getAttribute("display"),n=r.getAttribute("display"),o="block"===e||"block"===n;return{mathml:t.outerHTML,latex:t.getAttribute("alttext")||null,isBlock:o}}}const n=t.querySelector(".katex-mathml math");return n?{mathml:n.outerHTML,latex:null,isBlock:!1}:null},e.getBasicLatexFromElement=t=>{var e,r,n;const o=t.getAttribute("data-latex");if(o)return o;if("img"===t.tagName.toLowerCase()&&t.classList.contains("latex")){const e=t.getAttribute("alt");if(e)return e;const r=t.getAttribute("src");if(r){const t=r.match(/latex\.php\?latex=([^&]+)/);if(t)return decodeURIComponent(t[1]).replace(/\+/g," ").replace(/%5C/g,"\\")}}const i=t.querySelector('annotation[encoding="application/x-tex"]');if(null==i?void 0:i.textContent)return i.textContent.trim();if(t.matches(".katex")){const e=t.querySelector('.katex-mathml annotation[encoding="application/x-tex"]');if(null==e?void 0:e.textContent)return e.textContent.trim()}if(t.matches('script[type="math/tex"]')||t.matches('script[type="math/tex; mode=display"]'))return(null===(e=t.textContent)||void 0===e?void 0:e.trim())||null;if(t.parentElement){const e=t.parentElement.querySelector('script[type="math/tex"], script[type="math/tex; mode=display"]');if(e)return(null===(r=e.textContent)||void 0===r?void 0:r.trim())||null}return t.getAttribute("alt")||(null===(n=t.textContent)||void 0===n?void 0:n.trim())||null},e.isBlockDisplay=t=>{if("block"===t.getAttribute("display"))return!0;const e=t.className.toLowerCase();if(e.includes("display")||e.includes("block"))return!0;if(t.closest('.katex-display, .MathJax_Display, [data-display="block"]'))return!0;const r=t.previousElementSibling;if("p"===(null==r?void 0:r.tagName.toLowerCase()))return!0;if(t.matches(".mwe-math-fallback-image-display"))return!0;if(t.matches(".katex"))return null!==t.closest(".katex-display");if(t.hasAttribute("display"))return"true"===t.getAttribute("display");if(t.matches('script[type="math/tex; mode=display"]'))return!0;if(t.hasAttribute("display"))return"true"===t.getAttribute("display");const n=t.closest("[display]");return!!n&&"true"===n.getAttribute("display")},e.mathSelectors=['img.latex[src*="latex.php"]',"span.MathJax","mjx-container",'script[type="math/tex"]','script[type="math/tex; mode=display"]','.MathJax_Preview + script[type="math/tex"]',".MathJax_Display",".MathJax_SVG",".MathJax_MathML",".mwe-math-element",".mwe-math-fallback-image-inline",".mwe-math-fallback-image-display",".mwe-math-mathml-inline",".mwe-math-mathml-display",".katex",".katex-display",".katex-mathml",".katex-html","[data-katex]",'script[type="math/katex"]',"math","[data-math]","[data-latex]","[data-tex]",'script[type^="math/"]','annotation[encoding="application/x-tex"]'].join(",")},397:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ClaudeExtractor=void 0;const n=r(181);class o extends n.ConversationExtractor{constructor(t,e){super(t,e),this.articles=t.querySelectorAll('div[data-testid="user-message"], div[data-testid="assistant-message"], div.font-claude-message')}canExtract(){return!!this.articles&&this.articles.length>0}extractMessages(){const t=[];return this.articles?(this.articles.forEach((e=>{let r,n;if(e.hasAttribute("data-testid")){if("user-message"!==e.getAttribute("data-testid"))return;r="you",n=e.innerHTML}else{if(!e.classList.contains("font-claude-message"))return;r="assistant",n=e.innerHTML}n&&t.push({author:"you"===r?"You":"Claude",content:n.trim(),metadata:{role:r}})})),t):t}getMetadata(){const t=this.getTitle(),e=this.extractMessages();return{title:t,site:"Claude",url:this.url,messageCount:e.length,description:`Claude conversation with ${e.length} messages`}}getTitle(){var t,e,r,n,o;const i=null===(t=this.document.title)||void 0===t?void 0:t.trim();if(i&&"Claude"!==i)return i.replace(/ - Claude$/,"");const a=null===(r=null===(e=this.document.querySelector("header .font-tiempos"))||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim();if(a)return a;const s=null===(o=null===(n=this.articles)||void 0===n?void 0:n.item(0))||void 0===o?void 0:o.querySelector('[data-testid="user-message"]');if(s){const t=s.textContent||"";return t.length>50?t.slice(0,50)+"...":t}return"Claude Conversation"}}e.ClaudeExtractor=o},458:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.HackerNewsExtractor=void 0;const n=r(279);class o extends n.BaseExtractor{constructor(t,e){super(t,e),this.mainPost=t.querySelector(".fatitem"),this.isCommentPage=this.detectCommentPage(),this.mainComment=this.isCommentPage?this.findMainComment():null}detectCommentPage(){var t;return!!(null===(t=this.mainPost)||void 0===t?void 0:t.querySelector('.navs a[href*="parent"]'))}findMainComment(){var t;return(null===(t=this.mainPost)||void 0===t?void 0:t.querySelector(".comment"))||null}canExtract(){return!!this.mainPost}extract(){const t=this.getPostContent(),e=this.extractComments(),r=this.createContentHtml(t,e),n=this.getPostTitle(),o=this.getPostAuthor(),i=this.createDescription(),a=this.getPostDate();return{content:r,contentHtml:r,extractedContent:{postId:this.getPostId(),postAuthor:o},variables:{title:n,author:o,site:"Hacker News",description:i,published:a}}}createContentHtml(t,e){return`\n\t\t\t<div class="hackernews-post">\n\t\t\t\t<div class="post-content">\n\t\t\t\t\t${t}\n\t\t\t\t</div>\n\t\t\t\t${e?`\n\t\t\t\t\t<hr>\n\t\t\t\t\t<h2>Comments</h2>\n\t\t\t\t\t<div class="hackernews-comments">\n\t\t\t\t\t\t${e}\n\t\t\t\t\t</div>\n\t\t\t\t`:""}\n\t\t\t</div>\n\t\t`.trim()}getPostContent(){var t,e,r,n,o,i;if(!this.mainPost)return"";if(this.isCommentPage&&this.mainComment){const i=(null===(t=this.mainComment.querySelector(".hnuser"))||void 0===t?void 0:t.textContent)||"[deleted]",a=(null===(e=this.mainComment.querySelector(".commtext"))||void 0===e?void 0:e.innerHTML)||"",s=this.mainComment.querySelector(".age"),l=((null==s?void 0:s.getAttribute("title"))||"").split("T")[0]||"",c=(null===(n=null===(r=this.mainComment.querySelector(".score"))||void 0===r?void 0:r.textContent)||void 0===n?void 0:n.trim())||"",d=(null===(o=this.mainPost.querySelector('.navs a[href*="parent"]'))||void 0===o?void 0:o.getAttribute("href"))||"";return`\n\t\t\t\t<div class="comment main-comment">\n\t\t\t\t\t<div class="comment-metadata">\n\t\t\t\t\t\t<span class="comment-author"><strong>${i}</strong></span> \u2022\n\t\t\t\t\t\t<span class="comment-date">${l}</span>\n\t\t\t\t\t\t${c?` \u2022 <span class="comment-points">${c}</span>`:""}\n\t\t\t\t\t\t${d?` \u2022 <a href="https://news.ycombinator.com/${d}" class="parent-link">parent</a>`:""}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="comment-content">${a}</div>\n\t\t\t\t</div>\n\t\t\t`.trim()}const a=this.mainPost.querySelector("tr.athing"),s=(null==a||a.nextElementSibling,(null===(i=null==a?void 0:a.querySelector(".titleline a"))||void 0===i?void 0:i.getAttribute("href"))||"");let l="";s&&(l+=`<p><a href="${s}" target="_blank">${s}</a></p>`);const c=this.mainPost.querySelector(".toptext");return c&&(l+=`<div class="post-text">${c.innerHTML}</div>`),l}extractComments(){const t=Array.from(this.document.querySelectorAll("tr.comtr"));return this.processComments(t)}processComments(t){var e,r,n,o;let i="";const a=new Set;let s=-1,l=[];for(const c of t){const t=c.getAttribute("id");if(!t||a.has(t))continue;a.add(t);const d=(null===(e=c.querySelector(".ind img"))||void 0===e?void 0:e.getAttribute("width"))||"0",u=parseInt(d)/40,m=c.querySelector(".commtext"),h=(null===(r=c.querySelector(".hnuser"))||void 0===r?void 0:r.textContent)||"[deleted]",p=c.querySelector(".age"),g=(null===(o=null===(n=c.querySelector(".score"))||void 0===n?void 0:n.textContent)||void 0===o?void 0:o.trim())||"";if(!m)continue;const f=`https://news.ycombinator.com/item?id=${t}`,v=((null==p?void 0:p.getAttribute("title"))||"").split("T")[0]||"";if(0===u){for(;l.length>0;)i+="</blockquote>",l.pop();i+="<blockquote>",l=[0],s=0}else if(u<s)for(;l.length>0&&l[l.length-1]>=u;)i+="</blockquote>",l.pop();else u>s&&(i+="<blockquote>",l.push(u));i+=`<div class="comment">\n\t<div class="comment-metadata">\n\t\t<span class="comment-author"><strong>${h}</strong></span> \u2022\n\t\t<a href="${f}" class="comment-link">${v}</a>\n\t\t${g?` \u2022 <span class="comment-points">${g}</span>`:""}\n\t</div>\n\t<div class="comment-content">${m.innerHTML}</div>\n</div>`,s=u}for(;l.length>0;)i+="</blockquote>",l.pop();return i}getPostId(){const t=this.url.match(/id=(\d+)/);return(null==t?void 0:t[1])||""}getPostTitle(){var t,e,r,n,o;if(this.isCommentPage&&this.mainComment){const r=(null===(t=this.mainComment.querySelector(".hnuser"))||void 0===t?void 0:t.textContent)||"[deleted]",n=(null===(e=this.mainComment.querySelector(".commtext"))||void 0===e?void 0:e.textContent)||"";return`Comment by ${r}: ${n.trim().slice(0,50)+(n.length>50?"...":"")}`}return(null===(o=null===(n=null===(r=this.mainPost)||void 0===r?void 0:r.querySelector(".titleline"))||void 0===n?void 0:n.textContent)||void 0===o?void 0:o.trim())||""}getPostAuthor(){var t,e,r;return(null===(r=null===(e=null===(t=this.mainPost)||void 0===t?void 0:t.querySelector(".hnuser"))||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim())||""}createDescription(){const t=this.getPostTitle(),e=this.getPostAuthor();return this.isCommentPage?`Comment by ${e} on Hacker News`:`${t} - by ${e} on Hacker News`}getPostDate(){if(!this.mainPost)return"";const t=this.mainPost.querySelector(".age");return((null==t?void 0:t.getAttribute("title"))||"").split("T")[0]||""}}e.HackerNewsExtractor=o},552:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isElement=function(t){return t.nodeType===n.NODE_TYPE.ELEMENT_NODE},e.getComputedStyle=function(t){const e=o(t.ownerDocument);return e?e.getComputedStyle(t):null},e.getWindow=o,e.logDebug=function(t,...e){"undefined"!=typeof window&&window.defuddleDebug&&console.log("Defuddle:",t,...e)};const n=r(640);function o(t){return t.defaultView?t.defaultView:t.ownerWindow?t.ownerWindow:t.window?t.window:null}},608:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataExtractor=void 0,e.MetadataExtractor=class{static extract(t,e){var r,n;let o="",i="";try{if(i=(null===(r=t.location)||void 0===r?void 0:r.href)||"",i||(i=this.getMetaContent(t,"property","og:url")||this.getMetaContent(t,"property","twitter:url")||this.getSchemaProperty(t,e,"url")||this.getSchemaProperty(t,e,"mainEntityOfPage.url")||this.getSchemaProperty(t,e,"mainEntity.url")||this.getSchemaProperty(t,e,"WebSite.url")||(null===(n=t.querySelector('link[rel="canonical"]'))||void 0===n?void 0:n.getAttribute("href"))||""),i)try{o=new URL(i).hostname.replace(/^www\./,"")}catch(t){console.warn("Failed to parse URL:",t)}}catch(e){const r=t.querySelector("base[href]");if(r)try{i=r.getAttribute("href")||"",o=new URL(i).hostname.replace(/^www\./,"")}catch(t){console.warn("Failed to parse base URL:",t)}}return{title:this.getTitle(t,e),description:this.getDescription(t,e),domain:o,favicon:this.getFavicon(t,i),image:this.getImage(t,e),published:this.getPublished(t,e),author:this.getAuthor(t,e),site:this.getSite(t,e),schemaOrgData:e,wordCount:0,parseTime:0}}static getAuthor(t,e){return this.getMetaContent(t,"name","sailthru.author")||this.getSchemaProperty(t,e,"author.name")||this.getMetaContent(t,"property","author")||this.getMetaContent(t,"name","byl")||this.getMetaContent(t,"name","author")||this.getMetaContent(t,"name","authorList")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(t,e,"copyrightHolder.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(t,e,"publisher.name")||this.getSchemaProperty(t,e,"sourceOrganization.name")||this.getSchemaProperty(t,e,"isPartOf.name")||this.getMetaContent(t,"name","twitter:creator")||this.getMetaContent(t,"name","application-name")||""}static getSite(t,e){return this.getSchemaProperty(t,e,"publisher.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(t,e,"WebSite.name")||this.getSchemaProperty(t,e,"sourceOrganization.name")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(t,e,"copyrightHolder.name")||this.getSchemaProperty(t,e,"isPartOf.name")||this.getMetaContent(t,"name","application-name")||this.getAuthor(t,e)||""}static getTitle(t,e){var r,n;const o=this.getMetaContent(t,"property","og:title")||this.getMetaContent(t,"name","twitter:title")||this.getSchemaProperty(t,e,"headline")||this.getMetaContent(t,"name","title")||this.getMetaContent(t,"name","sailthru.title")||(null===(n=null===(r=t.querySelector("title"))||void 0===r?void 0:r.textContent)||void 0===n?void 0:n.trim())||"";return this.cleanTitle(o,this.getSite(t,e))}static cleanTitle(t,e){if(!t||!e)return t;const r=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=[`\\s*[\\|\\-\u2013\u2014]\\s*${r}\\s*$`,`^\\s*${r}\\s*[\\|\\-\u2013\u2014]\\s*`];for(const e of n){const r=new RegExp(e,"i");if(r.test(t)){t=t.replace(r,"");break}}return t.trim()}static getDescription(t,e){return this.getMetaContent(t,"name","description")||this.getMetaContent(t,"property","description")||this.getMetaContent(t,"property","og:description")||this.getSchemaProperty(t,e,"description")||this.getMetaContent(t,"name","twitter:description")||this.getMetaContent(t,"name","sailthru.description")||""}static getImage(t,e){return this.getMetaContent(t,"property","og:image")||this.getMetaContent(t,"name","twitter:image")||this.getSchemaProperty(t,e,"image.url")||this.getMetaContent(t,"name","sailthru.image.full")||""}static getFavicon(t,e){var r,n;const o=this.getMetaContent(t,"property","og:image:favicon");if(o)return o;const i=null===(r=t.querySelector("link[rel='icon']"))||void 0===r?void 0:r.getAttribute("href");if(i)return i;const a=null===(n=t.querySelector("link[rel='shortcut icon']"))||void 0===n?void 0:n.getAttribute("href");if(a)return a;if(e)try{return new URL("/favicon.ico",e).href}catch(t){console.warn("Failed to construct favicon URL:",t)}return""}static getPublished(t,e){return this.getSchemaProperty(t,e,"datePublished")||this.getMetaContent(t,"name","publishDate")||this.getMetaContent(t,"property","article:published_time")||this.getTimeElement(t)||this.getMetaContent(t,"name","sailthru.date")||""}static getMetaContent(t,e,r){var n,o;const i=`meta[${e}]`,a=Array.from(t.querySelectorAll(i)).find((t=>{var n;return(null===(n=t.getAttribute(e))||void 0===n?void 0:n.toLowerCase())===r.toLowerCase()})),s=a&&null!==(o=null===(n=a.getAttribute("content"))||void 0===n?void 0:n.trim())&&void 0!==o?o:"";return this.decodeHTMLEntities(s,t)}static getTimeElement(t){var e,r,n,o;const i=Array.from(t.querySelectorAll("time"))[0],a=i&&null!==(o=null!==(r=null===(e=i.getAttribute("datetime"))||void 0===e?void 0:e.trim())&&void 0!==r?r:null===(n=i.textContent)||void 0===n?void 0:n.trim())&&void 0!==o?o:"";return this.decodeHTMLEntities(a,t)}static decodeHTMLEntities(t,e){const r=e.createElement("textarea");return r.innerHTML=t,r.value}static getSchemaProperty(t,e,r,n=""){if(!e)return n;const o=(t,e,r,n=!0)=>{if("string"==typeof t)return 0===e.length?[t]:[];if(!t||"object"!=typeof t)return[];if(Array.isArray(t)){const i=e[0];if(/^\[\d+\]$/.test(i)){const a=parseInt(i.slice(1,-1));return t[a]?o(t[a],e.slice(1),r,n):[]}return 0===e.length&&t.every((t=>"string"==typeof t||"number"==typeof t))?t.map(String):t.flatMap((t=>o(t,e,r,n)))}const[i,...a]=e;if(!i)return"string"==typeof t?[t]:"object"==typeof t&&t.name?[t.name]:[];if(t.hasOwnProperty(i))return o(t[i],a,r?`${r}.${i}`:i,!0);if(!n){const n=[];for(const i in t)if("object"==typeof t[i]){const a=o(t[i],e,r?`${r}.${i}`:i,!1);n.push(...a)}if(n.length>0)return n}return[]};try{let i=o(e,r.split("."),"",!0);0===i.length&&(i=o(e,r.split("."),"",!1));const a=i.length>0?i.filter(Boolean).join(", "):n;return this.decodeHTMLEntities(a,t)}catch(t){return console.error(`Error in getSchemaProperty for ${r}:`,t),n}}static extractSchemaOrgData(t){const e=t.querySelectorAll('script[type="application/ld+json"]'),r=[];return e.forEach((t=>{let e=t.textContent||"";try{e=e.replace(/\/\*[\s\S]*?\*\/|^\s*\/\/.*$/gm,"").replace(/^\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*$/,"$1").replace(/^\s*(\*\/|\/\*)\s*|\s*(\*\/|\/\*)\s*$/g,"").trim();const t=JSON.parse(e);t["@graph"]&&Array.isArray(t["@graph"])?r.push(...t["@graph"]):r.push(t)}catch(t){console.error("Error parsing schema.org data:",t),console.error("Problematic JSON content:",e)}})),r}}},610:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.standardizeFootnotes=function(t){const e=t.ownerDocument;e?new o(e).standardizeFootnotes(t):console.warn("standardizeFootnotes: No document available")};const n=r(640);class o{constructor(t){this.doc=t}createFootnoteItem(t,e,r){const n="string"==typeof e?this.doc:e.ownerDocument,o=n.createElement("li");if(o.className="footnote",o.id=`fn:${t}`,"string"==typeof e){const t=n.createElement("p");t.innerHTML=e,o.appendChild(t)}else{const t=Array.from(e.querySelectorAll("p"));if(0===t.length){const t=n.createElement("p");t.innerHTML=e.innerHTML,o.appendChild(t)}else t.forEach((t=>{const e=n.createElement("p");e.innerHTML=t.innerHTML,o.appendChild(e)}))}const i=o.querySelector("p:last-of-type")||o;return r.forEach(((t,e)=>{const o=n.createElement("a");o.href=`#${t}`,o.title="return to article",o.className="footnote-backref",o.innerHTML="\u21a9",e<r.length-1&&(o.innerHTML+=" "),i.appendChild(o)})),o}collectFootnotes(t){const e={};let r=1;const o=new Set;return t.querySelectorAll(n.FOOTNOTE_LIST_SELECTORS).forEach((t=>{if(t.matches('div.footnote[data-component-name="FootnoteToDOM"]')){const n=t.querySelector("a.footnote-number"),i=t.querySelector(".footnote-content");if(n&&i){const t=n.id.replace("footnote-","").toLowerCase();t&&!o.has(t)&&(e[r]={content:i,originalId:t,refs:[]},o.add(t),r++)}}else t.querySelectorAll('li, div[role="listitem"]').forEach((t=>{var n,i,a,s;let l="",c=null;const d=t.querySelector(".citations");if(null===(n=null==d?void 0:d.id)||void 0===n?void 0:n.toLowerCase().startsWith("r")){l=d.id.toLowerCase();const t=d.querySelector(".citation-content");t&&(c=t)}else{if(t.id.toLowerCase().startsWith("bib.bib"))l=t.id.replace("bib.bib","").toLowerCase();else if(t.id.toLowerCase().startsWith("fn:"))l=t.id.replace("fn:","").toLowerCase();else if(t.id.toLowerCase().startsWith("fn"))l=t.id.replace("fn","").toLowerCase();else if(t.hasAttribute("data-counter"))l=(null===(a=null===(i=t.getAttribute("data-counter"))||void 0===i?void 0:i.replace(/\.$/,""))||void 0===a?void 0:a.toLowerCase())||"";else{const e=null===(s=t.id.split("/").pop())||void 0===s?void 0:s.match(/cite_note-(.+)/);l=e?e[1].toLowerCase():t.id.toLowerCase()}c=t}l&&!o.has(l)&&(e[r]={content:c||t,originalId:l,refs:[]},o.add(l),r++)}))})),e}findOuterFootnoteContainer(t){let e=t,r=t.parentElement;for(;r&&("span"===r.tagName.toLowerCase()||"sup"===r.tagName.toLowerCase());)e=r,r=r.parentElement;return e}createFootnoteReference(t,e){const r=this.doc.createElement("sup");r.id=e;const n=this.doc.createElement("a");return n.href=`#fn:${t}`,n.textContent=t,r.appendChild(n),r}standardizeFootnotes(t){const e=this.collectFootnotes(t),r=t.querySelectorAll(n.FOOTNOTE_INLINE_REFERENCES),o=new Map;r.forEach((t=>{var r,n,i,a;if(!t)return;let s="",l="";if(t.matches('a[id^="ref-link"]'))s=(null===(r=t.textContent)||void 0===r?void 0:r.trim())||"";else if(t.matches('a[role="doc-biblioref"]')){const e=t.getAttribute("data-xml-rid");if(e)s=e;else{const e=t.getAttribute("href");(null==e?void 0:e.startsWith("#core-R"))&&(s=e.replace("#core-",""))}}else if(t.matches("a.footnote-anchor, span.footnote-hovercard-target a")){const e=(null===(n=t.id)||void 0===n?void 0:n.replace("footnote-anchor-",""))||"";e&&(s=e.toLowerCase())}else if(t.matches("cite.ltx_cite")){const e=t.querySelector("a");if(e){const t=e.getAttribute("href");if(t){const e=null===(i=t.split("/").pop())||void 0===i?void 0:i.match(/bib\.bib(\d+)/);e&&(s=e[1].toLowerCase())}}}else if(t.matches("sup.reference")){const e=t.querySelectorAll("a");Array.from(e).forEach((t=>{var e;const r=t.getAttribute("href");if(r){const t=null===(e=r.split("/").pop())||void 0===e?void 0:e.match(/(?:cite_note|cite_ref)-(.+)/);t&&(s=t[1].toLowerCase())}}))}else if(t.matches('sup[id^="fnref:"]'))s=t.id.replace("fnref:","").toLowerCase();else if(t.matches('sup[id^="fnr"]'))s=t.id.replace("fnr","").toLowerCase();else if(t.matches("span.footnote-reference"))s=t.getAttribute("data-footnote-id")||"";else if(t.matches("span.footnote-link"))s=t.getAttribute("data-footnote-id")||"",l=t.getAttribute("data-footnote-content")||"";else if(t.matches("a.citation"))s=(null===(a=t.textContent)||void 0===a?void 0:a.trim())||"",l=t.getAttribute("href")||"";else if(t.matches('a[id^="fnref"]'))s=t.id.replace("fnref","").toLowerCase();else{const e=t.getAttribute("href");if(e){const t=e.replace(/^[#]/,"");s=t.toLowerCase()}}if(s){const r=Object.entries(e).find((([t,e])=>e.originalId===s.toLowerCase()));if(r){const[e,n]=r,i=n.refs.length>0?`fnref:${e}-${n.refs.length+1}`:`fnref:${e}`;n.refs.push(i);const a=this.findOuterFootnoteContainer(t);"sup"===a.tagName.toLowerCase()?(o.has(a)||o.set(a,[]),o.get(a).push(this.createFootnoteReference(e,i))):a.replaceWith(this.createFootnoteReference(e,i))}}})),o.forEach(((t,e)=>{if(t.length>0){const r=this.doc.createDocumentFragment();t.forEach((t=>{const e=t.querySelector("a");if(e){const n=this.doc.createElement("sup");n.id=t.id,n.appendChild(e.cloneNode(!0)),r.appendChild(n)}})),e.replaceWith(r)}}));const i=this.doc.createElement("div");i.id="footnotes";const a=this.doc.createElement("ol");Object.entries(e).forEach((([t,e])=>{const r=this.createFootnoteItem(parseInt(t),e.content,e.refs);a.appendChild(r)})),t.querySelectorAll(n.FOOTNOTE_LIST_SELECTORS).forEach((t=>t.remove())),a.children.length>0&&(i.appendChild(a),t.appendChild(i))}}},628:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Defuddle=void 0;const n=r(608),o=r(917),i=r(640),a=r(840),s=r(968),l=r(552);e.Defuddle=class{constructor(t,e={}){this.doc=t,this.options=e,this.debug=e.debug||!1}parse(){const t=this.parseInternal();if(t.wordCount<200){console.log("Initial parse returned very little content, trying again");const e=this.parseInternal({removePartialSelectors:!1});if(e.wordCount>t.wordCount)return this._log("Retry produced more content"),e}return t}parseInternal(t={}){var e,r,i;const l=Date.now(),c=Object.assign(Object.assign({removeExactSelectors:!0,removePartialSelectors:!0},this.options),t),d=n.MetadataExtractor.extractSchemaOrgData(this.doc),u=n.MetadataExtractor.extract(this.doc,d);try{const t=c.url||this.doc.URL,n=o.ExtractorRegistry.findExtractor(this.doc,t,d);if(n&&n.canExtract()){const t=n.extract(),o=Date.now();return{content:t.contentHtml,title:(null===(e=t.variables)||void 0===e?void 0:e.title)||u.title,description:u.description,domain:u.domain,favicon:u.favicon,image:u.image,published:(null===(r=t.variables)||void 0===r?void 0:r.published)||u.published,author:(null===(i=t.variables)||void 0===i?void 0:i.author)||u.author,site:u.site,schemaOrgData:u.schemaOrgData,wordCount:this.countWords(t.contentHtml),parseTime:Math.round(o-l),extractorType:n.constructor.name.replace("Extractor","").toLowerCase()}}const m=this._evaluateMediaQueries(this.doc),h=this.findSmallImages(this.doc),p=this.doc.cloneNode(!0);this.applyMobileStyles(p,m);const g=this.findMainContent(p);if(!g){const t=Date.now();return Object.assign(Object.assign({content:this.doc.body.innerHTML},u),{wordCount:this.countWords(this.doc.body.innerHTML),parseTime:Math.round(t-l)})}this.removeSmallImages(p,h),this.removeHiddenElements(p),s.ContentScorer.scoreAndRemove(p,this.debug),(c.removeExactSelectors||c.removePartialSelectors)&&this.removeBySelector(p,c.removeExactSelectors,c.removePartialSelectors),(0,a.standardizeContent)(g,u,this.doc,this.debug);const f=g.outerHTML,v=Date.now();return Object.assign(Object.assign({content:f},u),{wordCount:this.countWords(f),parseTime:Math.round(v-l)})}catch(t){console.error("Defuddle","Error processing document:",t);const e=Date.now();return Object.assign(Object.assign({content:this.doc.body.innerHTML},u),{wordCount:this.countWords(this.doc.body.innerHTML),parseTime:Math.round(e-l)})}}countWords(t){const e=this.doc.createElement("div");return e.innerHTML=t,(e.textContent||"").trim().replace(/\s+/g," ").split(" ").filter((t=>t.length>0)).length}_log(...t){this.debug&&console.log("Defuddle:",...t)}_evaluateMediaQueries(t){const e=[],r=/max-width[^:]*:\s*(\d+)/;try{Array.from(t.styleSheets).filter((t=>{try{return t.cssRules,!0}catch(t){return t instanceof DOMException&&t.name,!1}})).flatMap((t=>{try{return"undefined"==typeof CSSMediaRule?[]:Array.from(t.cssRules).filter((t=>t instanceof CSSMediaRule&&t.conditionText.includes("max-width")))}catch(t){return this.debug&&console.warn("Defuddle: Failed to process stylesheet:",t),[]}})).forEach((t=>{const n=t.conditionText.match(r);if(n){const r=parseInt(n[1]);i.MOBILE_WIDTH<=r&&Array.from(t.cssRules).filter((t=>t instanceof CSSStyleRule)).forEach((t=>{try{e.push({selector:t.selectorText,styles:t.style.cssText})}catch(t){this.debug&&console.warn("Defuddle: Failed to process CSS rule:",t)}}))}}))}catch(t){console.error("Defuddle: Error evaluating media queries:",t)}return e}applyMobileStyles(t,e){e.forEach((({selector:e,styles:r})=>{try{t.querySelectorAll(e).forEach((t=>{t.setAttribute("style",(t.getAttribute("style")||"")+r)}))}catch(t){console.error("Defuddle","Error applying styles for selector:",e,t)}}))}removeHiddenElements(t){let e=0;const r=new Set,n=Array.from(t.getElementsByTagName("*"));for(let o=0;o<n.length;o+=100){const i=n.slice(o,o+100),a=i.map((e=>{var r,n;try{return null===(r=e.ownerDocument.defaultView)||void 0===r?void 0:r.getComputedStyle(e)}catch(r){const o=e.getAttribute("style");if(!o)return null;const i=t.createElement("style");i.textContent=`* { ${o} }`,t.head.appendChild(i);const a=null===(n=e.ownerDocument.defaultView)||void 0===n?void 0:n.getComputedStyle(e);return t.head.removeChild(i),a}}));i.forEach(((t,n)=>{const o=a[n];!o||"none"!==o.display&&"hidden"!==o.visibility&&"0"!==o.opacity||(r.add(t),e++)}))}this._log("Removed hidden elements:",e)}removeBySelector(t,e=!0,r=!0){const n=Date.now();let o=0,a=0;const s=new Set;if(e&&t.querySelectorAll(i.EXACT_SELECTORS.join(",")).forEach((t=>{(null==t?void 0:t.parentNode)&&(s.add(t),o++)})),r){const e=i.PARTIAL_SELECTORS.join("|"),r=new RegExp(e,"i"),n=i.TEST_ATTRIBUTES.map((t=>`[${t}]`)).join(",");t.querySelectorAll(n).forEach((t=>{if(s.has(t))return;const e=i.TEST_ATTRIBUTES.map((e=>"class"===e?t.className&&"string"==typeof t.className?t.className:"":"id"===e?t.id||"":t.getAttribute(e)||"")).join(" ").toLowerCase();e.trim()&&r.test(e)&&(s.add(t),a++)}))}s.forEach((t=>t.remove()));const l=Date.now();this._log("Removed clutter elements:",{exactSelectors:o,partialSelectors:a,total:s.size,processingTime:`${(l-n).toFixed(2)}ms`})}findSmallImages(t){const e=new Set,r=/scale\(([\d.]+)\)/,n=Date.now();let o=0;const i=[...Array.from(t.getElementsByTagName("img")),...Array.from(t.getElementsByTagName("svg"))];if(0===i.length)return e;const a=i.map((t=>({element:t,naturalWidth:"img"===t.tagName.toLowerCase()&&parseInt(t.getAttribute("width")||"0")||0,naturalHeight:"img"===t.tagName.toLowerCase()&&parseInt(t.getAttribute("height")||"0")||0,attrWidth:parseInt(t.getAttribute("width")||"0"),attrHeight:parseInt(t.getAttribute("height")||"0")})));for(let t=0;t<a.length;t+=50){const n=a.slice(t,t+50);try{const t=n.map((({element:t})=>{var e;try{return null===(e=t.ownerDocument.defaultView)||void 0===e?void 0:e.getComputedStyle(t)}catch(t){return null}})),i=n.map((({element:t})=>{try{return t.getBoundingClientRect()}catch(t){return null}}));n.forEach(((n,a)=>{var s;try{const l=t[a],c=i[a];if(!l)return;const d=l.transform,u=d?parseFloat((null===(s=d.match(r))||void 0===s?void 0:s[1])||"1"):1,m=[n.naturalWidth,n.attrWidth,parseInt(l.width)||0,c?c.width*u:0].filter((t=>"number"==typeof t&&t>0)),h=[n.naturalHeight,n.attrHeight,parseInt(l.height)||0,c?c.height*u:0].filter((t=>"number"==typeof t&&t>0));if(m.length>0&&h.length>0){const t=Math.min(...m),r=Math.min(...h);if(t<33||r<33){const t=this.getElementIdentifier(n.element);t&&(e.add(t),o++)}}}catch(t){this.debug&&console.warn("Defuddle: Failed to process element dimensions:",t)}}))}catch(t){this.debug&&console.warn("Defuddle: Failed to process batch:",t)}}const s=Date.now();return this._log("Found small elements:",{count:o,processingTime:`${(s-n).toFixed(2)}ms`}),e}removeSmallImages(t,e){let r=0;["img","svg"].forEach((n=>{const o=t.getElementsByTagName(n);Array.from(o).forEach((t=>{const n=this.getElementIdentifier(t);n&&e.has(n)&&(t.remove(),r++)}))})),this._log("Removed small elements:",r)}getElementIdentifier(t){if("img"===t.tagName.toLowerCase()){const e=t.getAttribute("data-src");if(e)return`src:${e}`;const r=t.getAttribute("src")||"",n=t.getAttribute("srcset")||"",o=t.getAttribute("data-srcset");if(r)return`src:${r}`;if(n)return`srcset:${n}`;if(o)return`srcset:${o}`}const e=t.id||"",r=t.className||"",n="svg"===t.tagName.toLowerCase()&&t.getAttribute("viewBox")||"";return e?`id:${e}`:n?`viewBox:${n}`:r?`class:${r}`:null}findMainContent(t){const e=[];if(i.ENTRY_POINT_ELEMENTS.forEach(((r,n)=>{t.querySelectorAll(r).forEach((t=>{let r=40*(i.ENTRY_POINT_ELEMENTS.length-n);r+=s.ContentScorer.scoreElement(t),e.push({element:t,score:r})}))})),0===e.length)return this.findContentByScoring(t);if(e.sort(((t,e)=>e.score-t.score)),this.debug&&this._log("Content candidates:",e.map((t=>({element:t.element.tagName,selector:this.getElementSelector(t.element),score:t.score})))),1===e.length&&"body"===e[0].element.tagName.toLowerCase()){const e=this.findTableBasedContent(t);if(e)return e}return e[0].element}findTableBasedContent(t){if(!Array.from(t.getElementsByTagName("table")).some((t=>{const e=parseInt(t.getAttribute("width")||"0"),r=this.getComputedStyle(t);return e>400||(null==r?void 0:r.width.includes("px"))&&parseInt(r.width)>400||"center"===t.getAttribute("align")||t.className.toLowerCase().includes("content")||t.className.toLowerCase().includes("article")})))return null;const e=Array.from(t.getElementsByTagName("td"));return s.ContentScorer.findBestElement(e)}findContentByScoring(t){const e=[];return i.BLOCK_ELEMENTS.forEach((r=>{Array.from(t.getElementsByTagName(r)).forEach((t=>{const r=s.ContentScorer.scoreElement(t);r>0&&e.push({score:r,element:t})}))})),e.length>0?e.sort(((t,e)=>e.score-t.score))[0].element:null}getElementSelector(t){const e=[];let r=t;for(;r&&r!==this.doc.documentElement;){let t=r.tagName.toLowerCase();r.id?t+="#"+r.id:r.className&&"string"==typeof r.className&&(t+="."+r.className.trim().split(/\s+/).join(".")),e.unshift(t),r=r.parentElement}return e.join(" > ")}getComputedStyle(t){return(0,l.getComputedStyle)(t)}}},632:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatGPTExtractor=void 0;const n=r(181);class o extends n.ConversationExtractor{constructor(t,e){super(t,e),this.articles=t.querySelectorAll('article[data-testid^="conversation-turn-"]'),this.footnotes=[],this.footnoteCounter=0}canExtract(){return!!this.articles&&this.articles.length>0}extractMessages(){const t=[];return this.footnotes=[],this.footnoteCounter=0,this.articles?(this.articles.forEach((e=>{var r,n;const o=e.querySelector("h5.sr-only, h6.sr-only"),i=(null===(n=null===(r=null==o?void 0:o.textContent)||void 0===r?void 0:r.trim())||void 0===n?void 0:n.replace(/:\s*$/,""))||"";let a="";const s=e.getAttribute("data-message-author-role");s&&(a=s);let l=e.innerHTML||"";l=l.replace(/\u200B/g,"");const c=document.createElement("div");c.innerHTML=l,c.querySelectorAll('h5.sr-only, h6.sr-only, span[data-state="closed"]').forEach((t=>t.remove())),l=c.innerHTML,l=l.replace(/(&ZeroWidthSpace;)?(<span[^>]*?>\s*<a(?=[^>]*?href="([^"]+)")(?=[^>]*?target="_blank")(?=[^>]*?rel="noopener")[^>]*?>[\s\S]*?<\/a>\s*<\/span>)/gi,((t,e,r,n)=>{let o="",i="";try{o=new URL(n).hostname.replace(/^www\./,"");const t=n.split("#:~:text=");if(t.length>1){i=decodeURIComponent(t[1]),i=i.replace(/%2C/g,",");const e=i.split(",");i=e.length>1&&e[0].trim()?` \u2014 ${e[0].trim()}...`:e[0].trim()?` \u2014 ${i.trim()}`:""}}catch(t){console.error(`Failed to parse URL: ${n}`,t),o=n}let a,s=this.footnotes.findIndex((t=>t.url===n));return-1===s?(this.footnoteCounter++,a=this.footnoteCounter,this.footnotes.push({url:n,text:`<a href="${n}">${o}</a>${i}`})):a=s+1,`<sup id="fnref:${a}"><a href="#fn:${a}">${a}</a></sup>`})),l=l.replace(/<p[^>]*>\s*<\/p>/g,""),t.push({author:i,content:l.trim(),metadata:{role:a||"unknown"}})})),t):t}getFootnotes(){return this.footnotes}getMetadata(){const t=this.getTitle(),e=this.extractMessages();return{title:t,site:"ChatGPT",url:this.url,messageCount:e.length,description:`ChatGPT conversation with ${e.length} messages`}}getTitle(){var t,e,r;const n=null===(t=this.document.title)||void 0===t?void 0:t.trim();if(n&&"ChatGPT"!==n)return n;const o=null===(r=null===(e=this.articles)||void 0===e?void 0:e.item(0))||void 0===r?void 0:r.querySelector(".text-message");if(o){const t=o.textContent||"";return t.length>50?t.slice(0,50)+"...":t}return"ChatGPT Conversation"}}e.ChatGPTExtractor=o},640:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ALLOWED_ATTRIBUTES_DEBUG=e.ALLOWED_ATTRIBUTES=e.ALLOWED_EMPTY_ELEMENTS=e.FOOTNOTE_LIST_SELECTORS=e.FOOTNOTE_INLINE_REFERENCES=e.PARTIAL_SELECTORS=e.TEST_ATTRIBUTES=e.EXACT_SELECTORS=e.INLINE_ELEMENTS=e.PRESERVE_ELEMENTS=e.BLOCK_ELEMENTS=e.MOBILE_WIDTH=e.ENTRY_POINT_ELEMENTS=e.NODE_TYPE=void 0,e.NODE_TYPE={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},e.ENTRY_POINT_ELEMENTS=["#post",".post-content",".article-content","#article-content",".article_post",".article-wrapper",".entry-content",".content-article",".post",".markdown-body","article",'[role="article"]',"main",'[role="main"]',"body"],e.MOBILE_WIDTH=600,e.BLOCK_ELEMENTS=["div","section","article","main","aside","header","footer","nav","content"],e.PRESERVE_ELEMENTS=new Set(["pre","code","table","thead","tbody","tr","td","th","ul","ol","li","dl","dt","dd","figure","figcaption","picture","details","summary","blockquote","form","fieldset"]),e.INLINE_ELEMENTS=new Set(["a","span","strong","em","i","b","u","code","br","small","sub","sup","mark","date","del","ins","q","abbr","cite","relative-time","time","font"]),e.EXACT_SELECTORS=["noscript",'script:not([type^="math/"])',"style","meta","link",'.ad:not([class*="gradient"])','[class^="ad-" i]','[class$="-ad" i]','[id^="ad-" i]','[id$="-ad" i]','[role="banner" i]','[alt*="advert" i]',".promo",".Promo","#barrier-page",".alert",'[id="comments" i]','[id="comment" i]',"header",".header:not(.banner)","#header","#Header","#banner","#Banner","nav",".navigation","#navigation",".hero",'[role="navigation" i]','[role="dialog" i]','[role*="complementary" i]','[class*="pagination" i]',".menu","#menu","#siteSub",".fixed",".previous",".author",".Author",'[class$="_bio"]',"#categories",".contributor",".date","#date","[data-date]",".entry-meta",".meta",".tags","#tags",".toc",".Toc","#toc",".headline","#headline","#title","#Title","#articleTag",'[href*="/category"]','[href*="/categories"]','[href*="/tag/"]','[href*="/tags/"]','[href*="/topics"]','[href*="author"]','[href*="#toc"]','[href="#top"]','[href="#Top"]','[href="#page-header"]','[href="#content"]','[href="#site-content"]','[href="#main-content"]','[href^="#main"]','[src*="author"]',"footer",".aside","aside","button","canvas","date","dialog","fieldset","form",'input:not([type="checkbox"])',"label","option","select","textarea","time","relative-time","[hidden]",'[aria-hidden="true"]:not([class*="math"])','[style*="display: none"]:not([class*="math"])','[style*="display:none"]:not([class*="math"])','[style*="visibility: hidden"]','[style*="visibility:hidden"]',".hidden",".invisible","instaread-player",'iframe:not([src*="youtube"]):not([src*="youtu.be"]):not([src*="vimeo"]):not([src*="twitter"]):not([src*="x.com"]):not([src*="datawrapper"])','[class="logo" i]',"#logo","#Logo","#newsletter","#Newsletter",".subscribe",".noprint",'[data-print-layout="hide" i]','[data-block="donotprint" i]','[class*="clickable-icon" i]','li span[class*="ltx_tag" i][class*="ltx_tag_item" i]','a[href^="#"][class*="anchor" i]','a[href^="#"][class*="ref" i]','[data-container*="most-viewed" i]',".sidebar",".Sidebar","#sidebar","#Sidebar","#sitesub",'[data-link-name*="skip" i]','[aria-label*="skip" i]',"#skip-link",".copyright","#copyright","#rss","#feed",".gutter","#primaryaudio","#NYT_ABOVE_MAIN_CONTENT_REGION",'[data-testid="photoviewer-children-figure"] > span',"table.infobox",".pencraft:not(.pc-display-contents)",'[data-optimizely="related-articles-section" i]','[data-orientation="vertical"]'],e.TEST_ATTRIBUTES=["class","id","data-test","data-testid","data-test-id","data-qa","data-cy"],e.PARTIAL_SELECTORS=["a-statement","access-wall","activitypub","actioncall","addcomment","advert","adlayout","ad-tldr","ad-placement","ads-container","_ad_","after_content","after_main_article","afterpost","allterms","-alert-","alert-box","appendix","_archive","around-the-web","aroundpages","article-author","article-badges","article-banner","article-bottom-section","article-bottom","article-category","article-card","article-citation","article__copy","article_date","article-date","article-end ","article_header","article-header","article__header","article__hero","article__info","article-info","article-meta","article_meta","article__meta","articlename","article-subject","article_subject","article-snippet","article-separator","article--share","article--topics","articletags","article-tags","article_tags","articletitle","article-title","article_title","articletopics","article-topics","article--lede","articlewell","associated-people","audio-card","author-bio","author-box","author-info","author_info","authorm","author-mini-bio","author-name","author-publish-info","authored-by","avatar","back-to-top","backlink_container","backlinks-section","bio-block","biobox","blog-pager","bookmark-","-bookmark","bottominfo","bottomnav","bottom-of-article","bottom-wrapper","brand-bar","breadcrumb","brdcrumb","button-wrapper","buttons-container","btn-","-btn","byline","captcha","card-text","card-media","card-post","carouselcontainer","carousel-container","cat_header","catlinks","_categories","card-author","card-content","chapter-list","collections","comments","commentbox","comment-button","commentcomp","comment-content","comment-count","comment-form","comment-number","comment-respond","comment-thread","comment-wrap","complementary","consent","contact-","content-card","content-topics","contentpromo","context-bar","context-widget","core-collateral","cover-","created-date","creative-commons_","c-subscribe","_cta","-cta","cta-","cta_","current-issue","custom-list-number","dateline","dateheader","date-header","date-pub","disclaimer","disclosure","discussion","discuss_","disqus","donate","donation","dropdown","eletters","emailsignup","engagement-widget","enhancement","entry-author-info","entry-categories","entry-date","entry-title","entry-utility","-error","error-","eyebrow","expand-reduce","external-anchor","externallinkembedwrapper","extra-services","extra-title","facebook","fancy-box","favorite","featured-content","feedback","feed-links","field-site-sections","fixheader","floating-vid","follower","footer","footnote-back","footnoteback","form-group","for-you","frontmatter","further-reading","fullbleedheader","gated-","gh-feed","gist-meta","goog-","graph-view","hamburger","header_logo","header-logo","header-pattern","hero-list","hide-for-print","hide-print","hide-when-no-script","hidden-print","hidden-sidenote","hidden-accessibility","infoline","instacartIntegration","interlude","interaction","itemendrow","invisible","jumplink","jump-to-","keepreading","keep-reading","keep_reading","keyword_wrap","kicker","labstab","-labels","language-name","lastupdated","latest-content","-ledes-","-license","license-","lightbox-popup","like-button","link-box","links-grid","links-title","listing-dynamic-terms","list-tags","listinks","loading","loa-info","logo_container","ltx_role_refnum","ltx_tag_bibitem","ltx_error","masthead","marketing","media-inquiry","-menu","menu-","metadata","might-like","minibio","more-about","_modal","-modal","more-","morenews","morestories","more_wrapper","most-read","move-helper","mw-editsection","mw-cite-backlink","mw-indicators","mw-jump-link","nav-","nav_","navigation-post","next-","newsgallery","news-story-title","newsletter_","newsletterbanner","newslettercontainer","newsletter-form","newsletter-signup","newslettersignup","newsletterwidget","newsletterwrapper","not-found","notessection","nomobile","noprint","open-slideshow","originally-published","other-blogs","outline-view","pagehead","page-header","page-title","paywall_message","-partners","permission-","plea","popular","popup_links","pop_stories","pop-up","post-author","post-bottom","post__category","postcomment","postdate","post-date","post_date","post-details","post-feeds","postinfo","post-info","post_info","post-inline-date","post-links","postlist","post_list","post_meta","post-meta","postmeta","post_more","postnavi","post-navigation","postpath","post-preview","postsnippet","post_snippet","post-snippet","post-subject","posttax","post-tax","post_tax","posttag","post_tag","post-tag","post_time","posttitle","post-title","post_title","post__title","post-ufi-button","prev-post","prevnext","prev_next","prev-next","previousnext","press-inquiries","print-none","print-header","print:hidden","privacy-notice","privacy-settings","profile","promo_article","promo-bar","promo-box","pubdate","pub_date","pub-date","publish_date","publish-date","publication-date","publicationName","qr-code","qr_code","quick_up","_rail","ratingssection","read_also","readmore","read-next","read_next","read_time","read-time","reading_time","reading-time","reading-list","recent-","recent-articles","recentpost","recent_post","recent-post","recommend","redirectedfrom","recirc","register","related","relevant","reversefootnote","_rss","rss-link","screen-reader-text","scroll_to","scroll-to","_search","-search","section-nav","series-banner","share-box","sharedaddy","share-icons","sharelinks","share-post","share-print","share-section","show-for-print","sidebartitle","sidebar-content","sidebar-wrapper","sideitems","sidebar-author","sidebar-item","side-box","side-logo","sign-in-gate","similar-","similar_","similars-","site-index","site-header","siteheader","site-logo","site-name","site-wordpress","skip-content","skip-to-content","c-skip-link","_skip-link","-slider","slug-wrap","social-author","social-shar","social-date","speechify-ignore","speedbump","sponsor","springercitation","sr-only","_stats","story-date","story-navigation","storyreadtime","storysmall","storypublishdate","subject-label","subhead","submenu","-subscribe-","subscriber-drive","subscription-","_tags","tags__item","tag_list","taxonomy","table-of-contents","tabs-","terminaltout","time-rubric","timestamp","time-read","time-to-read","tip_off","tiptout","-tout-","toc-container","toggle-caption","tooltip","topbar","topic-list","topic-subnav","top-wrapper","tree-item","trending","trust-feat","trust-badge","trust-project","twitter","u-hide","upsell","viewbottom","visually-hidden","welcomebox","widget_pages"],e.FOOTNOTE_INLINE_REFERENCES=["sup.reference","cite.ltx_cite",'sup[id^="fnr"]','span[id^="fnr"]','span[class*="footnote_ref"]',"span.footnote-link","a.citation",'a[id^="ref-link"]','a[href^="#fn"]','a[href^="#cite"]','a[href^="#reference"]','a[href^="#footnote"]','a[href^="#r"]','a[href^="#b"]','a[href*="cite_note"]','a[href*="cite_ref"]',"a.footnote-anchor","span.footnote-hovercard-target a",'a[role="doc-biblioref"]','a[id^="fnref"]','a[id^="ref-link"]'].join(","),e.FOOTNOTE_LIST_SELECTORS=["div.footnote ol","div.footnotes ol",'div[role="doc-endnotes"]','div[role="doc-footnotes"]',"ol.footnotes-list","ol.footnotes","ol.references",'ol[class*="article-references"]',"section.footnotes ol",'section[role="doc-endnotes"]','section[role="doc-footnotes"]','section[role="doc-bibliography"]',"ul.footnotes-list","ul.ltx_biblist",'div.footnote[data-component-name="FootnoteToDOM"]'].join(","),e.ALLOWED_EMPTY_ELEMENTS=new Set(["area","audio","base","br","circle","col","defs","ellipse","embed","figure","g","hr","iframe","img","input","line","link","mask","meta","object","param","path","pattern","picture","polygon","polyline","rect","source","stop","svg","td","th","track","use","video","wbr"]),e.ALLOWED_ATTRIBUTES=new Set(["alt","allow","allowfullscreen","aria-label","checked","colspan","controls","data-latex","data-src","data-srcset","data-lang","dir","display","frameborder","headers","height","href","lang","role","rowspan","src","srcset","title","type","width","accent","accentunder","align","columnalign","columnlines","columnspacing","columnspan","data-mjx-texclass","depth","displaystyle","fence","frame","framespacing","linethickness","lspace","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","rowalign","rowlines","rowspacing","rowspan","rspace","scriptlevel","separator","stretchy","symmetric","voffset","xmlns"]),e.ALLOWED_ATTRIBUTES_DEBUG=new Set(["class","id"])},649:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.imageRules=void 0;const r=/^data:image\/([^;]+);base64,/,n=/\.(jpg|jpeg|png|webp)\s+\d/,o=/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/,i=/\.(jpg|jpeg|png|webp|gif|avif)(\?.*)?$/i,a=/\s(\d+)w/,s=/dpr=(\d+(?:\.\d+)?)/,l=/^([^\s]+)/,c=/^[\w\-\.\/\\]+\.(jpg|jpeg|png|gif|webp|svg)$/i,d=/^\d{4}-\d{2}-\d{2}$/;function u(t,e,r){const n=r.createElement("figure");n.appendChild(t.cloneNode(!0));const o=r.createElement("figcaption"),i=function(t){const e=[],r=new Set,n=t=>{var o;if(t.nodeType===Node.TEXT_NODE){const n=(null===(o=t.textContent)||void 0===o?void 0:o.trim())||"";n&&!r.has(n)&&(e.push(n),r.add(n))}else if(t.nodeType===Node.ELEMENT_NODE){const e=t.childNodes;for(let t=0;t<e.length;t++)n(e[t])}},o=t.childNodes;for(let t=0;t<o.length;t++)n(o[t]);return e.length>0?e.join(" "):t.innerHTML}(e);return o.innerHTML=i,n.appendChild(o),n}function m(t,e){e.setAttribute("srcset",t);const r=x(t);r&&f(r)&&e.setAttribute("src",r)}function h(t,e,r){for(let n=0;n<t.attributes.length;n++){const o=t.attributes[n];r.includes(o.name)||e.setAttribute(o.name,o.value)}}function p(t){const e=t.match(r);if(!e)return!1;if("svg+xml"===e[1])return!1;const n=e[0].length;return t.length-n<133}function g(t){return t.startsWith("data:image/svg+xml")}function f(t){return!t.startsWith("data:")&&!(!t||""===t.trim())&&(i.test(t)||t.includes("image")||t.includes("img")||t.includes("photo"))}function v(t){return!!E(t)||t.querySelectorAll("img, video, picture, source").length>0}function E(t){const e=t.tagName.toLowerCase();return"img"===e||"video"===e||"picture"===e||"source"===e}function b(t){if(E(t))return t;const e=t.querySelectorAll("picture");if(e.length>0)return e[0];const r=t.querySelectorAll("img"),n=[];for(let t=0;t<r.length;t++){const e=r[t],o=e.getAttribute("src")||"",i=e.getAttribute("alt")||"";o.includes("data:image/svg+xml")||p(o)||!i.trim()&&r.length>1||n.push(e)}if(n.length>0)return n[0];const o=t.querySelectorAll("video");if(o.length>0)return o[0];const i=t.querySelectorAll("source");if(i.length>0)return i[0];const a=t.querySelectorAll("img, picture, source, video");return a.length>0?a[0]:null}function y(t){var e,r,n,o;const i=t.querySelector("figcaption");if(i)return i;const a=new Set,s=['[class*="caption"]','[class*="description"]','[class*="alt"]','[class*="title"]','[class*="credit"]','[class*="text"]','[class*="post-thumbnail-text"]','[class*="image-caption"]','[class*="photo-caption"]',"[aria-label]","[title]"].join(", "),l=t.querySelectorAll(s);for(let t=0;t<l.length;t++){const r=l[t];if(E(r))continue;const n=null===(e=r.textContent)||void 0===e?void 0:e.trim();if(n&&n.length>0&&!a.has(n))return a.add(n),r}const c=t.querySelector("img");if(c&&c.hasAttribute("alt")){const e=c.getAttribute("alt");if(e&&e.trim().length>0){const r=t.ownerDocument.createElement("div");return r.textContent=e,r}}if(t.parentElement){const e=t.parentElement.children;for(let n=0;n<e.length;n++){const o=e[n];if(o!==t&&Array.from(o.classList).some((t=>t.includes("caption")||t.includes("credit")||t.includes("text")||t.includes("description")))){const t=null===(r=o.textContent)||void 0===r?void 0:r.trim();if(t&&t.length>0)return o}}}const d=t.querySelectorAll("img");for(let t=0;t<d.length;t++){const e=d[t];if(!e.parentElement)continue;let r=e.nextElementSibling;for(;r;){if(["EM","STRONG","SPAN","I","B","SMALL","CITE"].includes(r.tagName)){const t=null===(n=r.textContent)||void 0===n?void 0:n.trim();if(t&&t.length>0)return r}r=r.nextElementSibling}}for(let t=0;t<d.length;t++){const e=d[t],r=e.parentElement;if(!r)continue;const n=r.querySelectorAll("em, strong, span, i, b, small, cite");for(let t=0;t<n.length;t++){const r=n[t];if(r===e)continue;const i=null===(o=r.textContent)||void 0===o?void 0:o.trim();if(i&&i.length>0)return r}}return null}function C(t){var e;const r=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"";return!(r.length<10||r.startsWith("http://")||r.startsWith("https://")||c.test(r)||r.match(/^\d+$/)||d.test(r))}function w(t,e){const r=t.tagName.toLowerCase();if("img"===r)return T(t,e);if("picture"===r){const r=t.querySelector("img");return r?T(r,e):t.cloneNode(!0)}return"source"===r?function(t,e){const r=e.createElement("img"),n=t.getAttribute("srcset");n&&m(n,r);const o=t.parentElement;if(o){const t=o.querySelectorAll("img"),e=[];for(let r=0;r<t.length;r++){const n=t[r],o=n.getAttribute("src")||"";p(o)||g(o)||""===o||e.push(n)}if(e.length>0){if(h(e[0],r,["src","srcset"]),!r.hasAttribute("src")||!f(r.getAttribute("src")||"")){const t=e[0].getAttribute("src");t&&f(t)&&r.setAttribute("src",t)}}else{const t=o.querySelector("img[data-src]");if(t&&(h(t,r,["src","srcset"]),!r.hasAttribute("src")||!f(r.getAttribute("src")||""))){const e=t.getAttribute("data-src");e&&f(e)&&r.setAttribute("src",e)}}}return r}(t,e):t.cloneNode(!0)}function T(t,e){const r=t.getAttribute("src")||"";if(p(r)||g(r)){const r=t.parentElement;if(r){const n=r.querySelectorAll("source"),o=[];for(let t=0;t<n.length;t++){const e=n[t];e.hasAttribute("data-srcset")&&""!==e.getAttribute("data-srcset")&&o.push(e)}if(o.length>0){const r=e.createElement("img"),n=t.getAttribute("data-src");return n&&!g(n)&&r.setAttribute("src",n),h(t,r,["src"]),r}}}return t.cloneNode(!0)}function x(t){const e=t.split(",");if(0===e.length)return null;const r=e[0].trim().match(l);if(r&&r[1]){const t=r[1];if(g(t)){for(let t=1;t<e.length;t++){const r=e[t].trim().match(l);if(r&&r[1]&&!g(r[1]))return r[1]}return null}return t}return null}function S(t){if(0===t.length)return null;if(1===t.length)return t[0];for(let e=0;e<t.length;e++)if(!t[e].hasAttribute("media"))return t[e];let e=null,r=0;for(let n=0;n<t.length;n++){const o=t[n],i=o.getAttribute("srcset");if(!i)continue;const l=i.match(a),c=i.match(s);if(l&&l[1]){const t=parseInt(l[1],10)*(c?parseFloat(c[1]):1);t>r&&(r=t,e=o)}}return e||t[0]}e.imageRules=[{selector:"picture",element:"picture",transform:(t,e)=>{const r=t.querySelectorAll("source"),n=t.querySelector("img");if(!n){console.warn("Picture element without img fallback:",t.outerHTML);const n=S(r);if(n){const r=n.getAttribute("srcset");if(r){const n=e.createElement("img");return m(r,n),t.innerHTML="",t.appendChild(n),t}}return t}let o=null,i=null;if(r.length>0){const t=S(r);t&&(o=t.getAttribute("srcset"),o&&(i=x(o)))}if(o&&n.setAttribute("srcset",o),i&&f(i))n.setAttribute("src",i);else if(!n.hasAttribute("src")||!f(n.getAttribute("src")||"")){const t=x(n.getAttribute("srcset")||o||"");t&&f(t)&&n.setAttribute("src",t)}return r.forEach((t=>t.remove())),t}},{selector:"uni-image-full-width",element:"figure",transform:(t,e)=>{var r;const n=e.createElement("figure"),o=e.createElement("img"),i=t.querySelector("img");if(!i)return console.warn("uni-image-full-width without img:",t.outerHTML),n;let a=i.getAttribute("src");const s=i.getAttribute("data-loading");if(s)try{const t=JSON.parse(s);t.desktop&&f(t.desktop)&&(a=t.desktop)}catch(t){console.warn("Failed to parse data-loading attribute:",s,t)}if(!a||!f(a))return console.warn("Could not find valid src for uni-image-full-width:",t.outerHTML),n;o.setAttribute("src",a);let l=i.getAttribute("alt");l||(l=t.getAttribute("alt-text")),l&&o.setAttribute("alt",l),n.appendChild(o);const c=t.querySelector("figcaption");if(c){const t=null===(r=c.textContent)||void 0===r?void 0:r.trim();if(t&&t.length>5){const r=e.createElement("figcaption"),o=c.querySelector(".rich-text p");o?r.innerHTML=o.innerHTML:r.textContent=t,n.appendChild(r)}}return n}},{selector:'img[data-src], img[data-srcset], img[loading="lazy"], img.lazy, img.lazyload',element:"img",transform:(t,e)=>{const r=t.getAttribute("src")||"",i=function(t){if(t.hasAttribute("data-src")||t.hasAttribute("data-srcset"))return!0;for(let e=0;e<t.attributes.length;e++){const r=t.attributes[e];if("src"!==r.name){if(r.name.startsWith("data-")&&/\.(jpg|jpeg|png|webp|gif)(\?.*)?$/i.test(r.value))return!0;if(/\.(jpg|jpeg|png|webp|gif)(\?.*)?$/i.test(r.value))return!0}}return!1}(t);p(r)&&i&&t.removeAttribute("src");const a=t.getAttribute("data-src");a&&!t.getAttribute("src")&&t.setAttribute("src",a);const s=t.getAttribute("data-srcset");s&&!t.getAttribute("srcset")&&t.setAttribute("srcset",s);for(let e=0;e<t.attributes.length;e++){const r=t.attributes[e];"src"!==r.name&&"srcset"!==r.name&&"alt"!==r.name&&(n.test(r.value)?t.setAttribute("srcset",r.value):o.test(r.value)&&t.setAttribute("src",r.value))}return t.classList.remove("lazy","lazyload"),t.removeAttribute("data-ll-status"),t.removeAttribute("data-src"),t.removeAttribute("data-srcset"),t.removeAttribute("loading"),t}},{selector:"span:has(img)",element:"span",transform:(t,e)=>{try{if(!v(t))return t;const r=b(t);if(!r)return t;const n=y(t),o=w(r,e);if(n&&C(n)){const t=u(o,n,e);return n.parentNode&&n.parentNode.removeChild(n),t}return o}catch(e){return console.warn("Error processing span with image:",e),t}}},{selector:'figure, p:has([class*="caption"])',element:"figure",transform:(t,e)=>{try{if(!v(t))return t;const r=b(t);if(!r)return t;const n=y(t);if(n&&C(n)){const o=b(t);let i;return o?i=o:(console.warn("Figure rule couldn't find current image element in:",t.outerHTML),i=w(r,e)),u(i,n,e)}return t}catch(e){return console.warn("Error processing complex image element:",e),t}}}]},732:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GeminiExtractor=void 0;const n=r(181);class o extends n.ConversationExtractor{constructor(t,e){super(t,e),this.messageCount=null,this.conversationContainers=t.querySelectorAll("div.conversation-container"),this.footnotes=[]}canExtract(){return!!this.conversationContainers&&this.conversationContainers.length>0}extractMessages(){this.messageCount=0;const t=[];return this.conversationContainers?(this.extractSources(),this.conversationContainers.forEach((e=>{const r=e.querySelector("user-query");if(r){const e=r.querySelector(".query-text");if(e){const r=e.innerHTML||"";t.push({author:"You",content:r.trim(),metadata:{role:"user"}})}}const n=e.querySelector("model-response");if(n){const e=n.querySelector(".model-response-text .markdown"),r=n.querySelector("#extended-response-markdown-content")||e;if(r){let e=r.innerHTML||"";const n=document.createElement("div");n.innerHTML=e,n.querySelectorAll(".table-content").forEach((t=>{t.classList.remove("table-content")})),e=n.innerHTML,t.push({author:"Gemini",content:e.trim(),metadata:{role:"assistant"}})}}})),this.messageCount=t.length,t):t}extractSources(){const t=this.document.querySelectorAll("browse-item");t&&t.length>0&&t.forEach((t=>{var e,r,n,o;const i=t.querySelector("a");if(i instanceof HTMLAnchorElement){const t=i.href,a=(null===(r=null===(e=i.querySelector(".domain"))||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim())||"",s=(null===(o=null===(n=i.querySelector(".title"))||void 0===n?void 0:n.textContent)||void 0===o?void 0:o.trim())||"";t&&(a||s)&&this.footnotes.push({url:t,text:s?`${a}: ${s}`:a})}}))}getFootnotes(){return this.footnotes}getMetadata(){var t;const e=this.getTitle(),r=null!==(t=this.messageCount)&&void 0!==t?t:this.extractMessages().length;return{title:e,site:"Gemini",url:this.url,messageCount:r,description:`Gemini conversation with ${r} messages`}}getTitle(){var t,e,r,n,o;const i=null===(t=this.document.title)||void 0===t?void 0:t.trim();if(i&&"Gemini"!==i&&!i.includes("Gemini"))return i;const a=null===(r=null===(e=this.document.querySelector(".title-text"))||void 0===e?void 0:e.textContent)||void 0===r?void 0:r.trim();if(a)return a;const s=null===(o=null===(n=this.conversationContainers)||void 0===n?void 0:n.item(0))||void 0===o?void 0:o.querySelector(".query-text");if(s){const t=s.textContent||"";return t.length>50?t.slice(0,50)+"...":t}return"Gemini Conversation"}}e.GeminiExtractor=o},754:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.codeBlockRules=void 0;const n=r(640),o=[/^language-(\w+)$/,/^lang-(\w+)$/,/^(\w+)-code$/,/^code-(\w+)$/,/^syntax-(\w+)$/,/^code-snippet__(\w+)$/,/^highlight-(\w+)$/,/^(\w+)-snippet$/,/(?:^|\s)(?:language|lang|brush|syntax)-(\w+)(?:\s|$)/i],i=new Set(["abap","actionscript","ada","adoc","agda","antlr4","applescript","arduino","armasm","asciidoc","aspnet","atom","bash","batch","c","clojure","cmake","cobol","coffeescript","cpp","c++","crystal","csharp","cs","dart","django","dockerfile","dotnet","elixir","elm","erlang","fortran","fsharp","gdscript","gitignore","glsl","golang","gradle","graphql","groovy","haskell","hs","haxe","hlsl","html","idris","java","javascript","js","jsx","jsdoc","json","jsonp","julia","kotlin","latex","lisp","elisp","livescript","lua","makefile","markdown","md","markup","masm","mathml","matlab","mongodb","mysql","nasm","nginx","nim","nix","objc","ocaml","pascal","perl","php","postgresql","powershell","prolog","puppet","python","regex","rss","ruby","rb","rust","scala","scheme","shell","sh","solidity","sparql","sql","ssml","svg","swift","tcl","terraform","tex","toml","typescript","ts","tsx","unrealscript","verilog","vhdl","webassembly","wasm","xml","yaml","yml","zig"]);e.codeBlockRules=[{selector:["pre",'div[class*="prismjs"]',".syntaxhighlighter",".highlight",".highlight-source",".wp-block-syntaxhighlighter-code",".wp-block-code",'div[class*="language-"]'].join(", "),element:"pre",transform:(t,e)=>{if(!(t=>"classList"in t&&"getAttribute"in t&&"querySelector"in t)(t))return t;const r=t=>{var e;const r=t.getAttribute("data-lang")||t.getAttribute("data-language");if(r)return r.toLowerCase();const n=Array.from(t.classList||[]);if(null===(e=t.classList)||void 0===e?void 0:e.contains("syntaxhighlighter")){const t=n.find((t=>!["syntaxhighlighter","nogutter"].includes(t)));if(t&&i.has(t.toLowerCase()))return t.toLowerCase()}for(const t of n)for(const e of o){const r=t.toLowerCase().match(e);if(r&&r[1]&&i.has(r[1].toLowerCase()))return r[1].toLowerCase()}for(const t of n)if(i.has(t.toLowerCase()))return t.toLowerCase();return""};let a="",s=t;for(;s&&!a;){a=r(s);const t=s.querySelector("code");!a&&t&&(a=r(t)),s=s.parentElement}const l=t=>{if(t.nodeType===n.NODE_TYPE.TEXT_NODE)return t.textContent||"";let e="";if(t.nodeType===n.NODE_TYPE.ELEMENT_NODE){if("BR"===t.tagName)return"\n";if(t.matches('div[class*="line"], span[class*="line"], .ec-line, [data-line-number], [data-line]')){const e=t.querySelector('.code, .content, [class*="code-"], [class*="content-"]');if(e)return(e.textContent||"")+"\n";const r=t.querySelector('.line-number, .gutter, [class*="line-number"], [class*="gutter"]');return r?Array.from(t.childNodes).filter((t=>!r.contains(t))).map((t=>l(t))).join("")+"\n":t.textContent+"\n"}t.childNodes.forEach((t=>{e+=l(t)}))}return e};let c="";t.matches(".syntaxhighlighter, .wp-block-syntaxhighlighter-code")&&(c=(t=>{const e=t.querySelector(".syntaxhighlighter table .code .container");if(e)return Array.from(e.children).map((t=>{const e=Array.from(t.querySelectorAll("code")).map((t=>{var e;let r=t.textContent||"";return(null===(e=t.classList)||void 0===e?void 0:e.contains("spaces"))&&(r=" ".repeat(r.length)),r})).join("");return e||t.textContent||""})).join("\n");const r=t.querySelectorAll(".code .line");return r.length>0?Array.from(r).map((t=>Array.from(t.querySelectorAll("code")).map((t=>t.textContent||"")).join("")||t.textContent||"")).join("\n"):""})(t)),c||(c=l(t)),c=c.replace(/^\s+|\s+$/g,"").replace(/\t/g,"    ").replace(/\n{3,}/g,"\n\n").replace(/\u00a0/g," ").replace(/^\n+/,"").replace(/\n+$/,"");const d=e.createElement("pre"),u=e.createElement("code");return a&&(u.setAttribute("data-lang",a),u.setAttribute("class",`language-${a}`)),u.textContent=c,d.appendChild(u),d}}]},840:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.standardizeContent=function(t,e,r,o=!1){(function(t){const e=t=>{if(t.nodeType===n.NODE_TYPE.ELEMENT_NODE){const e=t.tagName.toLowerCase();if("pre"===e||"code"===e)return}if(t.nodeType===n.NODE_TYPE.TEXT_NODE){const e=t.textContent||"",r=e.replace(/\xA0+/g,(e=>{var r,n,o,i;if(1===e.length){const e=null===(n=null===(r=t.previousSibling)||void 0===r?void 0:r.textContent)||void 0===n?void 0:n.slice(-1),a=null===(i=null===(o=t.nextSibling)||void 0===o?void 0:o.textContent)||void 0===i?void 0:i.charAt(0);if((null==e?void 0:e.match(/\w/))&&(null==a?void 0:a.match(/\w/)))return"\xa0"}return" ".repeat(e.length)}));r!==e&&(t.textContent=r)}t.hasChildNodes()&&Array.from(t.childNodes).forEach(e)};e(t)})(t),function(t){let e=0;Array.from(t.getElementsByTagName("*")).forEach((t=>{Array.from(t.childNodes).forEach((t=>{8===t.nodeType&&(t.remove(),e++)}))})),(0,c.logDebug)("Removed HTML comments:",e)}(t),function(t,e,r){const o=t=>t.replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase(),i=t.getElementsByTagName("h1");Array.from(i).forEach((t=>{var e;const o=r.createElement("h2");o.innerHTML=t.innerHTML,Array.from(t.attributes).forEach((t=>{n.ALLOWED_ATTRIBUTES.has(t.name)&&o.setAttribute(t.name,t.value)})),null===(e=t.parentNode)||void 0===e||e.replaceChild(o,t)}));const a=t.getElementsByTagName("h2");if(a.length>0){const t=a[0],r=o(t.textContent||""),n=o(e);n&&n===r&&t.remove()}}(t,e.title,r),(0,a.standardizeFootnotes)(t),function(t,e){let r=0;d.forEach((n=>{t.querySelectorAll(n.selector).forEach((t=>{if(n.transform){const o=n.transform(t,e);t.replaceWith(o),r++}}))})),t.querySelectorAll("lite-youtube").forEach((t=>{const n=t.getAttribute("videoid");if(!n)return;const o=e.createElement("iframe");o.width="560",o.height="315",o.src=`https://www.youtube.com/embed/${n}`,o.title=t.getAttribute("videotitle")||"YouTube video player",o.frameBorder="0",o.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",o.setAttribute("allowfullscreen",""),t.replaceWith(o),r++})),(0,c.logDebug)("Converted embedded elements:",r)}(t,r),o?(m(t,o),u(t),h(t),(0,c.logDebug)("Debug mode: Skipping div flattening to preserve structure")):(p(t,r),m(t,o),function(t){let e=0,r=0,o=!0;for(;o;){r++,o=!1;const i=Array.from(t.getElementsByTagName("*")).filter((t=>{if(n.ALLOWED_EMPTY_ELEMENTS.has(t.tagName.toLowerCase()))return!1;const e=t.textContent||"",r=0===e.trim().length,o=e.includes("\xa0"),i=!t.hasChildNodes()||Array.from(t.childNodes).every((t=>{if(t.nodeType===n.NODE_TYPE.TEXT_NODE){const e=t.textContent||"";return 0===e.trim().length&&!e.includes("\xa0")}return!1}));if("div"===t.tagName.toLowerCase()){const e=Array.from(t.children);if(e.length>0&&e.every((t=>{var e;if("span"!==t.tagName.toLowerCase())return!1;const r=(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"";return","===r||""===r||" "===r})))return!0}return r&&!o&&i}));i.length>0&&(i.forEach((t=>{t.remove(),e++})),o=!0)}(0,c.logDebug)("Removed empty elements:",e,"iterations:",r)}(t),u(t),p(t,r),h(t),function(t,e){let r=0;const o=Date.now(),i=t=>{var e;if(t.nodeType===n.NODE_TYPE.ELEMENT_NODE){const e=t.tagName.toLowerCase();if("pre"===e||"code"===e)return}if(Array.from(t.childNodes).forEach(i),t.nodeType===n.NODE_TYPE.TEXT_NODE){const n=t.textContent||"";if(!n||n.match(/^[\u200C\u200B\u200D\u200E\u200F\uFEFF\xA0\s]*$/))null===(e=t.parentNode)||void 0===e||e.removeChild(t),r++;else{const e=n.replace(/\n{3,}/g,"\n\n").replace(/^[\n\r\t]+/,"").replace(/[\n\r\t]+$/,"").replace(/[ \t]*\n[ \t]*/g,"\n").replace(/[ \t]{3,}/g," ").replace(/^[ ]+$/," ").replace(/\s+([,.!?:;])/g,"$1").replace(/[\u200C\u200B\u200D\u200E\u200F\uFEFF]+/g,"").replace(/(?:\xA0){2,}/g,"\xa0");e!==n&&(t.textContent=e,r+=n.length-e.length)}}},a=t=>{var o;if(!(0,c.isElement)(t))return;const i=t.tagName.toLowerCase();if("pre"===i||"code"===i)return;Array.from(t.childNodes).filter(c.isElement).forEach(a),t.normalize();const s="block"===(null===(o=(0,c.getComputedStyle)(t))||void 0===o?void 0:o.display),l=s?/^[\n\r\t \u200C\u200B\u200D\u200E\u200F\uFEFF\xA0]*$/:/^[\n\r\t\u200C\u200B\u200D\u200E\u200F\uFEFF]*$/,d=s?/^[\n\r\t \u200C\u200B\u200D\u200E\u200F\uFEFF\xA0]*$/:/^[\n\r\t\u200C\u200B\u200D\u200E\u200F\uFEFF]*$/;for(;t.firstChild&&t.firstChild.nodeType===n.NODE_TYPE.TEXT_NODE&&(t.firstChild.textContent||"").match(l);)t.removeChild(t.firstChild),r++;for(;t.lastChild&&t.lastChild.nodeType===n.NODE_TYPE.TEXT_NODE&&(t.lastChild.textContent||"").match(d);)t.removeChild(t.lastChild),r++;if(!s){const r=Array.from(t.childNodes);for(let o=0;o<r.length-1;o++){const i=r[o],a=r[o+1];if((0,c.isElement)(i)||(0,c.isElement)(a)){const r=a.textContent||"",o=i.textContent||"",s=r.match(/^[,.!?:;)\]]/),l=o.match(/[,.!?:;(\[]\s*$/),c=i.nodeType===n.NODE_TYPE.TEXT_NODE&&(i.textContent||"").endsWith(" ")||a.nodeType===n.NODE_TYPE.TEXT_NODE&&(a.textContent||"").startsWith(" ");if(!s&&!l&&!c){const r=e.createTextNode(" ");t.insertBefore(r,a)}}}}};i(t),a(t);const s=Date.now();(0,c.logDebug)("Removed empty lines:",{charactersRemoved:r,processingTime:`${(s-o).toFixed(2)}ms`})}(t,r))};const n=r(640),o=r(0),i=r(754),a=r(610),s=r(864),l=r(649),c=r(552),d=[...o.mathRules,...i.codeBlockRules,...s.headingRules,...l.imageRules,{selector:'div[data-testid^="paragraph"], div[role="paragraph"]',element:"p",transform:(t,e)=>{const r=e.createElement("p");return r.innerHTML=t.innerHTML,Array.from(t.attributes).forEach((t=>{n.ALLOWED_ATTRIBUTES.has(t.name)&&r.setAttribute(t.name,t.value)})),r}},{selector:'div[role="list"]',element:"ul",transform:(t,e)=>{var r;const n=t.querySelector('div[role="listitem"] .label'),o=((null===(r=null==n?void 0:n.textContent)||void 0===r?void 0:r.trim())||"").match(/^\d+\)/),i=e.createElement(o?"ol":"ul");return t.querySelectorAll('div[role="listitem"]').forEach((t=>{const r=e.createElement("li"),n=t.querySelector(".content");n&&(n.querySelectorAll('div[role="paragraph"]').forEach((t=>{const r=e.createElement("p");r.innerHTML=t.innerHTML,t.replaceWith(r)})),n.querySelectorAll('div[role="list"]').forEach((t=>{var r;const n=t.querySelector('div[role="listitem"] .label'),o=((null===(r=null==n?void 0:n.textContent)||void 0===r?void 0:r.trim())||"").match(/^\d+\)/),i=e.createElement(o?"ol":"ul");t.querySelectorAll('div[role="listitem"]').forEach((t=>{const r=e.createElement("li"),n=t.querySelector(".content");n&&(n.querySelectorAll('div[role="paragraph"]').forEach((t=>{const r=e.createElement("p");r.innerHTML=t.innerHTML,t.replaceWith(r)})),r.innerHTML=n.innerHTML),i.appendChild(r)})),t.replaceWith(i)})),r.innerHTML=n.innerHTML),i.appendChild(r)})),i}},{selector:'div[role="listitem"]',element:"li",transform:(t,e)=>{const r=t.querySelector(".content");return r?(r.querySelectorAll('div[role="paragraph"]').forEach((t=>{const r=e.createElement("p");r.innerHTML=t.innerHTML,t.replaceWith(r)})),r):t}}];function u(t){let e=0;const r=e=>{let o="",i=e.nextSibling;for(;i;)(i.nodeType===n.NODE_TYPE.TEXT_NODE||i.nodeType===n.NODE_TYPE.ELEMENT_NODE)&&(o+=i.textContent||""),i=i.nextSibling;if(o.trim())return!0;const a=e.parentElement;return!(!a||a===t)&&r(a)};Array.from(t.querySelectorAll("h1, h2, h3, h4, h5, h6")).reverse().forEach((t=>{r(t)||(t.remove(),e++)})),e>0&&(0,c.logDebug)("Removed trailing headings:",e)}function m(t,e){let r=0;const o=t=>{if("svg"===t.tagName.toLowerCase()||"http://www.w3.org/2000/svg"===t.namespaceURI)return;const o=Array.from(t.attributes),i=t.tagName.toLowerCase();o.forEach((o=>{const a=o.name.toLowerCase(),s=o.value;"id"===a&&(s.startsWith("fnref:")||s.startsWith("fn:")||"footnotes"===s)||"class"===a&&("code"===i&&s.startsWith("language-")||"footnote-backref"===s)||(e?n.ALLOWED_ATTRIBUTES.has(a)||n.ALLOWED_ATTRIBUTES_DEBUG.has(a)||a.startsWith("data-")||(t.removeAttribute(o.name),r++):n.ALLOWED_ATTRIBUTES.has(a)||(t.removeAttribute(o.name),r++))}))};o(t),t.querySelectorAll("*").forEach(o),(0,c.logDebug)("Stripped attributes:",r)}function h(t){let e=0;const r=Date.now(),o=Array.from(t.getElementsByTagName("br"));let i=[];const a=()=>{if(i.length>2)for(let t=2;t<i.length;t++)i[t].remove(),e++;i=[]};o.forEach((t=>{var e;let r=!1;if(i.length>0){const o=i[i.length-1];let a=t.previousSibling;for(;a&&a.nodeType===n.NODE_TYPE.TEXT_NODE&&!(null===(e=a.textContent)||void 0===e?void 0:e.trim());)a=a.previousSibling;a===o&&(r=!0)}r?i.push(t):(a(),i=[t])})),a();const s=Date.now();(0,c.logDebug)("Standardized br elements:",{removed:e,processingTime:`${(s-r).toFixed(2)}ms`})}function p(t,e){let r=0;const o=Date.now();let i=!0;function a(t){var e;for(const r of t.childNodes){if(r.nodeType===n.NODE_TYPE.TEXT_NODE&&(null===(e=r.textContent)||void 0===e?void 0:e.trim()))return!0;if(r.nodeType===n.NODE_TYPE.ELEMENT_NODE&&n.INLINE_ELEMENTS.has(r.nodeName.toLowerCase()))return!0}return!1}const s=t=>{const e=t.tagName.toLowerCase();if(n.PRESERVE_ELEMENTS.has(e))return!0;const r=t.getAttribute("role");if(r&&["article","main","navigation","banner","contentinfo"].includes(r))return!0;const o=t.className;return!("string"!=typeof o||!o.toLowerCase().match(/(?:article|main|content|footnote|reference|bibliography)/))||!!Array.from(t.children).some((t=>n.PRESERVE_ELEMENTS.has(t.tagName.toLowerCase())||"article"===t.getAttribute("role")||t.className&&"string"==typeof t.className&&t.className.toLowerCase().match(/(?:article|main|content|footnote|reference|bibliography)/)))},l=t=>{var e;if(a(t))return!1;if(!(null===(e=t.textContent)||void 0===e?void 0:e.trim()))return!0;const r=Array.from(t.children);if(0===r.length)return!0;if(r.every((t=>{const e=t.tagName.toLowerCase();return n.BLOCK_ELEMENTS.includes(e)||"p"===e||"h1"===e||"h2"===e||"h3"===e||"h4"===e||"h5"===e||"h6"===e||"ul"===e||"ol"===e||"pre"===e||"blockquote"===e||"figure"===e})))return!0;const o=t.className.toLowerCase();if(/(?:wrapper|container|layout|row|col|grid|flex|outer|inner|content-area)/i.test(o))return!0;const i=Array.from(t.childNodes).filter((t=>{var e;return t.nodeType===n.NODE_TYPE.TEXT_NODE&&(null===(e=t.textContent)||void 0===e?void 0:e.trim())}));return 0===i.length||!(!(r.length>0)||r.some((t=>{const e=t.tagName.toLowerCase();return n.INLINE_ELEMENTS.has(e)})))},d=o=>{var i,c;if(!o.isConnected||s(o))return!1;const d=o.tagName.toLowerCase();if(!n.ALLOWED_EMPTY_ELEMENTS.has(d)&&!o.children.length&&!(null===(i=o.textContent)||void 0===i?void 0:i.trim()))return o.remove(),r++,!0;if(o.parentElement===t){const t=Array.from(o.children);if(t.length>0&&!t.some((t=>{const e=t.tagName.toLowerCase();return n.INLINE_ELEMENTS.has(e)}))){const t=e.createDocumentFragment();for(;o.firstChild;)t.appendChild(o.firstChild);return o.replaceWith(t),r++,!0}}if(l(o)){if(!Array.from(o.children).some((t=>{const e=t.tagName.toLowerCase();return n.INLINE_ELEMENTS.has(e)}))){const t=e.createDocumentFragment();for(;o.firstChild;)t.appendChild(o.firstChild);return o.replaceWith(t),r++,!0}const t=e.createDocumentFragment();for(;o.firstChild;)t.appendChild(o.firstChild);return o.replaceWith(t),r++,!0}const u=Array.from(o.childNodes);if(u.length>0&&u.every((t=>t.nodeType===n.NODE_TYPE.TEXT_NODE||t.nodeType===n.NODE_TYPE.ELEMENT_NODE&&n.INLINE_ELEMENTS.has(t.nodeName.toLowerCase())))&&(null===(c=o.textContent)||void 0===c?void 0:c.trim())){const t=e.createElement("p");for(;o.firstChild;)t.appendChild(o.firstChild);return o.replaceWith(t),r++,!0}if(1===o.children.length){const t=o.firstElementChild,e=t.tagName.toLowerCase();if(n.BLOCK_ELEMENTS.includes(e)&&!s(t))return o.replaceWith(t),r++,!0}let m=0,h=o.parentElement;for(;h;){const t=h.tagName.toLowerCase();n.BLOCK_ELEMENTS.includes(t)&&m++,h=h.parentElement}if(m>0&&!a(o)){const t=e.createDocumentFragment();for(;o.firstChild;)t.appendChild(o.firstChild);return o.replaceWith(t),r++,!0}return!1},u=()=>{const e=Array.from(t.children).filter((t=>n.BLOCK_ELEMENTS.includes(t.tagName.toLowerCase())));let r=!1;return e.forEach((t=>{d(t)&&(r=!0)})),r},m=()=>{const e=Array.from(t.querySelectorAll(n.BLOCK_ELEMENTS.join(","))).sort(((t,e)=>{const r=t=>{let e=0,r=t.parentElement;for(;r;){const t=r.tagName.toLowerCase();n.BLOCK_ELEMENTS.includes(t)&&e++,r=r.parentElement}return e};return r(e)-r(t)}));let r=!1;return e.forEach((t=>{d(t)&&(r=!0)})),r},h=()=>{const o=Array.from(t.querySelectorAll(n.BLOCK_ELEMENTS.join(",")));let i=!1;return o.forEach((t=>{const n=Array.from(t.children);if(n.length>0&&n.every((t=>"p"===t.tagName.toLowerCase()))||!s(t)&&l(t)){const n=e.createDocumentFragment();for(;t.firstChild;)n.appendChild(t.firstChild);t.replaceWith(n),r++,i=!0}})),i};do{i=!1,u()&&(i=!0),m()&&(i=!0),h()&&(i=!0)}while(i);const p=Date.now();(0,c.logDebug)("Flattened wrapper elements:",{count:r,processingTime:`${(p-o).toFixed(2)}ms`})}},864:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.headingRules=void 0;const n=r(640);e.headingRules=[{selector:"h1, h2, h3, h4, h5, h6",element:"keep",transform:t=>{var e;const r=t.ownerDocument;if(!r)return console.warn("No document available"),t;const o=r.createElement(t.tagName);Array.from(t.attributes).forEach((t=>{n.ALLOWED_ATTRIBUTES.has(t.name)&&o.setAttribute(t.name,t.value)}));const i=t.cloneNode(!0),a=new Map;Array.from(i.querySelectorAll("*")).forEach((t=>{var e,r,n,o,s,l;let c=!1;if("a"===t.tagName.toLowerCase()){const r=t.getAttribute("href");((null==r?void 0:r.includes("#"))||(null==r?void 0:r.startsWith("#")))&&(a.set(t,(null===(e=t.textContent)||void 0===e?void 0:e.trim())||""),c=!0)}if(t.classList.contains("anchor")&&(a.set(t,(null===(r=t.textContent)||void 0===r?void 0:r.trim())||""),c=!0),"button"===t.tagName.toLowerCase()&&(c=!0),("span"===t.tagName.toLowerCase()||"div"===t.tagName.toLowerCase())&&t.querySelector('a[href^="#"]')){const e=t.querySelector('a[href^="#"]');e&&a.set(t,(null===(n=e.textContent)||void 0===n?void 0:n.trim())||""),c=!0}if(c){const e=t.parentElement;e&&e!==i&&(null===(o=e.textContent)||void 0===o?void 0:o.trim())===(null===(s=t.textContent)||void 0===s?void 0:s.trim())&&a.set(e,(null===(l=t.textContent)||void 0===l?void 0:l.trim())||"")}})),Array.from(i.querySelectorAll("*")).filter((t=>{if("a"===t.tagName.toLowerCase()){const e=t.getAttribute("href");return(null==e?void 0:e.includes("#"))||(null==e?void 0:e.startsWith("#"))}return!!t.classList.contains("anchor")||"button"===t.tagName.toLowerCase()||!("span"!==t.tagName.toLowerCase()&&"div"!==t.tagName.toLowerCase()||!t.querySelector('a[href^="#"]'))})).forEach((t=>t.remove()));let s=(null===(e=i.textContent)||void 0===e?void 0:e.trim())||"";return!s&&a.size>0&&(s=Array.from(a.values())[0]),o.textContent=s,o}}]},917:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtractorRegistry=void 0;const n=r(959),o=r(248),i=r(258),a=r(458),s=r(632),l=r(397),c=r(20),d=r(732);class u{static initialize(){this.register({patterns:["twitter.com",/\/x\.com\/.*/],extractor:o.TwitterExtractor}),this.register({patterns:["reddit.com","old.reddit.com","new.reddit.com",/^https:\/\/[^\/]+\.reddit\.com/],extractor:n.RedditExtractor}),this.register({patterns:["youtube.com","youtu.be",/youtube\.com\/watch\?v=.*/,/youtu\.be\/.*/],extractor:i.YoutubeExtractor}),this.register({patterns:[/news\.ycombinator\.com\/item\?id=.*/],extractor:a.HackerNewsExtractor}),this.register({patterns:[/^https?:\/\/chatgpt\.com\/(c|share)\/.*/],extractor:s.ChatGPTExtractor}),this.register({patterns:[/^https?:\/\/claude\.ai\/(chat|share)\/.*/],extractor:l.ClaudeExtractor}),this.register({patterns:[/^https?:\/\/grok\.com\/(chat|share)(\/.*)?$/],extractor:c.GrokExtractor}),this.register({patterns:[/^https?:\/\/gemini\.google\.com\/app\/.*/],extractor:d.GeminiExtractor})}static register(t){this.mappings.push(t)}static findExtractor(t,e,r){try{const n=new URL(e).hostname;if(this.domainCache.has(n)){const o=this.domainCache.get(n);return o?new o(t,e,r):null}for(const{patterns:o,extractor:i}of this.mappings)if(o.some((t=>t instanceof RegExp?t.test(e):n.includes(t))))return this.domainCache.set(n,i),new i(t,e,r);return this.domainCache.set(n,null),null}catch(t){return console.error("Error in findExtractor:",t),null}}static clearCache(){this.domainCache.clear()}}e.ExtractorRegistry=u,u.mappings=[],u.domainCache=new Map,u.initialize()},959:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RedditExtractor=void 0;const n=r(279);class o extends n.BaseExtractor{constructor(t,e){super(t,e),this.shredditPost=t.querySelector("shreddit-post")}canExtract(){return!!this.shredditPost}extract(){var t,e;const r=this.getPostContent(),n=this.extractComments(),o=this.createContentHtml(r,n),i=(null===(e=null===(t=this.document.querySelector("h1"))||void 0===t?void 0:t.textContent)||void 0===e?void 0:e.trim())||"",a=this.getSubreddit(),s=this.getPostAuthor(),l=this.createDescription(r);return{content:o,contentHtml:o,extractedContent:{postId:this.getPostId(),subreddit:a,postAuthor:s},variables:{title:i,author:s,site:`r/${a}`,description:l}}}getPostContent(){var t,e,r,n;return((null===(e=null===(t=this.shredditPost)||void 0===t?void 0:t.querySelector('[slot="text-body"]'))||void 0===e?void 0:e.innerHTML)||"")+((null===(n=null===(r=this.shredditPost)||void 0===r?void 0:r.querySelector("#post-image"))||void 0===n?void 0:n.outerHTML)||"")}createContentHtml(t,e){return`\n\t\t\t<div class="reddit-post">\n\t\t\t\t<div class="post-content">\n\t\t\t\t\t${t}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${e?`\n\t\t\t\t<hr>\n\t\t\t\t<h2>Comments</h2>\n\t\t\t\t<div class="reddit-comments">\n\t\t\t\t\t${e}\n\t\t\t\t</div>\n\t\t\t`:""}\n\t\t`.trim()}extractComments(){const t=Array.from(this.document.querySelectorAll("shreddit-comment"));return this.processComments(t)}getPostId(){const t=this.url.match(/comments\/([a-zA-Z0-9]+)/);return(null==t?void 0:t[1])||""}getSubreddit(){const t=this.url.match(/\/r\/([^/]+)/);return(null==t?void 0:t[1])||""}getPostAuthor(){var t;return(null===(t=this.shredditPost)||void 0===t?void 0:t.getAttribute("author"))||""}createDescription(t){var e;if(!t)return"";const r=document.createElement("div");return r.innerHTML=t,(null===(e=r.textContent)||void 0===e?void 0:e.trim().slice(0,140).replace(/\s+/g," "))||""}processComments(t){var e;let r="",n=-1,o=[];for(const i of t){const t=parseInt(i.getAttribute("depth")||"0"),a=i.getAttribute("author")||"",s=i.getAttribute("score")||"0",l=i.getAttribute("permalink")||"",c=(null===(e=i.querySelector('[slot="comment"]'))||void 0===e?void 0:e.innerHTML)||"",d=i.querySelector("faceplate-timeago"),u=(null==d?void 0:d.getAttribute("ts"))||"",m=u?new Date(u).toISOString().split("T")[0]:"";if(0===t){for(;o.length>0;)r+="</blockquote>",o.pop();r+="<blockquote>",o=[0],n=0}else if(t<n)for(;o.length>0&&o[o.length-1]>=t;)r+="</blockquote>",o.pop();else t>n&&(r+="<blockquote>",o.push(t));r+=`<div class="comment">\n\t<div class="comment-metadata">\n\t\t<span class="comment-author"><strong>${a}</strong></span> \u2022\n\t\t<a href="https://reddit.com${l}" class="comment-link">${s} points</a> \u2022\n\t\t<span class="comment-date">${m}</span>\n\t</div>\n\t<div class="comment-content">${c}</div>\n</div>`,n=t}for(;o.length>0;)r+="</blockquote>",o.pop();return r}}e.RedditExtractor=o},968:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ContentScorer=void 0;const n=r(640),o=["article","content","entry","image","img","font","figure","figcaption","pre","main","post","story","table"],i=["advertisement","all rights reserved","banner","cookie","comments","copyright","follow me","follow us","footer","header","homepage","login","menu","more articles","more like this","most read","nav","navigation","newsletter","newsletter","popular","privacy","recommended","register","related","responses","share","sidebar","sign in","sign up","signup","social","sponsored","subscribe","subscribe","terms","trending"],a=["ad","banner","cookie","copyright","footer","header","homepage","menu","nav","newsletter","popular","privacy","recommended","related","rights","share","sidebar","social","sponsored","subscribe","terms","trending","widget"];class s{constructor(t,e=!1){this.doc=t,this.debug=e}static scoreElement(t){let e=0;const r=t.textContent||"",o=r.split(/\s+/).length;e+=o,e+=10*t.getElementsByTagName("p").length,e-=t.getElementsByTagName("a").length/(o||1)*5,e-=t.getElementsByTagName("img").length/(o||1)*3;try{const r=t.getAttribute("style")||"",n=t.getAttribute("align")||"";(r.includes("float: right")||r.includes("text-align: right")||"right"===n)&&(e+=5)}catch(t){}/\b(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\s+\d{1,2},?\s+\d{4}\b/i.test(r)&&(e+=10),/\b(?:by|written by|author:)\s+[A-Za-z\s]+\b/i.test(r)&&(e+=10);const i=t.className.toLowerCase();if((i.includes("content")||i.includes("article")||i.includes("post"))&&(e+=15),t.querySelector(n.FOOTNOTE_INLINE_REFERENCES)&&(e+=10),t.querySelector(n.FOOTNOTE_LIST_SELECTORS)&&(e+=10),e-=5*t.getElementsByTagName("table").length,"td"===t.tagName.toLowerCase()){const r=t.closest("table");if(r){const n=parseInt(r.getAttribute("width")||"0"),o=r.getAttribute("align")||"",i=r.className.toLowerCase();if(n>400||"center"===o||i.includes("content")||i.includes("article")){const n=Array.from(r.getElementsByTagName("td")),o=n.indexOf(t);o>0&&o<n.length-1&&(e+=10)}}}return e}static findBestElement(t,e=50){let r=null,n=0;return t.forEach((t=>{const e=this.scoreElement(t);e>n&&(n=e,r=t)})),n>e?r:null}static scoreAndRemove(t,e=!1){const r=Date.now();let o=0;const i=new Set;Array.from(t.querySelectorAll(n.BLOCK_ELEMENTS.join(","))).forEach((t=>{i.has(t)||s.isLikelyContent(t)||s.scoreNonContentBlock(t)<0&&(i.add(t),o++)})),i.forEach((t=>t.remove()));const a=Date.now();e&&console.log("Defuddle","Removed non-content blocks:",{count:o,processingTime:`${(a-r).toFixed(2)}ms`})}static isLikelyContent(t){const e=t.getAttribute("role");if(e&&["article","main","contentinfo"].includes(e))return!0;const r=t.className.toLowerCase(),n=t.id.toLowerCase();for(const t of o)if(r.includes(t)||n.includes(t))return!0;const i=(t.textContent||"").split(/\s+/).length,a=t.getElementsByTagName("p").length;return i>50&&a>1||i>100||i>30&&a>0}static scoreNonContentBlock(t){if(t.querySelector(n.FOOTNOTE_LIST_SELECTORS))return 0;let e=0;const r=t.textContent||"",o=r.split(/\s+/).length;if(o<3)return 0;for(const t of i)r.toLowerCase().includes(t)&&(e-=10);const s=t.getElementsByTagName("a").length;s/(o||1)>.5&&(e-=15);const l=t.getElementsByTagName("ul").length+t.getElementsByTagName("ol").length;l>0&&s>3*l&&(e-=10);const c=t.className.toLowerCase(),d=t.id.toLowerCase();for(const t of a)(c.includes(t)||d.includes(t))&&(e-=8);return e}}e.ContentScorer=s}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}var n={};return(()=>{var t=n;const e=r(628);t.default=e.Defuddle})(),n.default})(),module.exports=e()},"./node_modules/webextension-polyfill/dist/browser-polyfill.js":function(module,exports){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,__WEBPACK_AMD_DEFINE_FACTORY__=function(module){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)module.exports=globalThis.browser;else{const CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE="The message port closed before a response was received.",wrapAPIs=extensionAPIs=>{const apiMetadata={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(apiMetadata).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class DefaultWeakMap extends WeakMap{constructor(createItem,items=void 0){super(items),this.createItem=createItem}get(key){return this.has(key)||this.set(key,this.createItem(key)),super.get(key)}}const makeCallback=(promise,metadata)=>(...callbackArgs)=>{extensionAPIs.runtime.lastError?promise.reject(new Error(extensionAPIs.runtime.lastError.message)):metadata.singleCallbackArg||callbackArgs.length<=1&&!1!==metadata.singleCallbackArg?promise.resolve(callbackArgs[0]):promise.resolve(callbackArgs)},pluralizeArguments=numArgs=>1==numArgs?"argument":"arguments",wrapMethod=(target,method,wrapper)=>new Proxy(method,{apply:(targetMethod,thisObj,args)=>wrapper.call(thisObj,target,...args)});let hasOwnProperty=Function.call.bind(Object.prototype.hasOwnProperty);const wrapObject=(target,wrappers={},metadata={})=>{let cache=Object.create(null),handlers={has:(proxyTarget,prop)=>prop in target||prop in cache,get(proxyTarget,prop,receiver){if(prop in cache)return cache[prop];if(!(prop in target))return;let value=target[prop];if("function"==typeof value)if("function"==typeof wrappers[prop])value=wrapMethod(target,target[prop],wrappers[prop]);else if(hasOwnProperty(metadata,prop)){let wrapper=((name,metadata)=>function asyncFunctionWrapper(target,...args){if(args.length<metadata.minArgs)throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);if(args.length>metadata.maxArgs)throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);return new Promise(((resolve,reject)=>{if(metadata.fallbackToNoCallback)try{target[name](...args,makeCallback({resolve,reject},metadata))}catch(cbError){console.warn(`${name} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,cbError),target[name](...args),metadata.fallbackToNoCallback=!1,metadata.noCallback=!0,resolve()}else metadata.noCallback?(target[name](...args),resolve()):target[name](...args,makeCallback({resolve,reject},metadata))}))})(prop,metadata[prop]);value=wrapMethod(target,target[prop],wrapper)}else value=value.bind(target);else if("object"==typeof value&&null!==value&&(hasOwnProperty(wrappers,prop)||hasOwnProperty(metadata,prop)))value=wrapObject(value,wrappers[prop],metadata[prop]);else{if(!hasOwnProperty(metadata,"*"))return Object.defineProperty(cache,prop,{configurable:!0,enumerable:!0,get:()=>target[prop],set(value){target[prop]=value}}),value;value=wrapObject(value,wrappers[prop],metadata["*"])}return cache[prop]=value,value},set:(proxyTarget,prop,value,receiver)=>(prop in cache?cache[prop]=value:target[prop]=value,!0),defineProperty:(proxyTarget,prop,desc)=>Reflect.defineProperty(cache,prop,desc),deleteProperty:(proxyTarget,prop)=>Reflect.deleteProperty(cache,prop)},proxyTarget=Object.create(target);return new Proxy(proxyTarget,handlers)},wrapEvent=wrapperMap=>({addListener(target,listener,...args){target.addListener(wrapperMap.get(listener),...args)},hasListener:(target,listener)=>target.hasListener(wrapperMap.get(listener)),removeListener(target,listener){target.removeListener(wrapperMap.get(listener))}}),onRequestFinishedWrappers=new DefaultWeakMap((listener=>"function"!=typeof listener?listener:function onRequestFinished(req){const wrappedReq=wrapObject(req,{},{getContent:{minArgs:0,maxArgs:0}});listener(wrappedReq)})),onMessageWrappers=new DefaultWeakMap((listener=>"function"!=typeof listener?listener:function onMessage(message,sender,sendResponse){let wrappedSendResponse,result,didCallSendResponse=!1,sendResponsePromise=new Promise((resolve=>{wrappedSendResponse=function(response){didCallSendResponse=!0,resolve(response)}}));try{result=listener(message,sender,wrappedSendResponse)}catch(err){result=Promise.reject(err)}const isResultThenable=!0!==result&&((value=result)&&"object"==typeof value&&"function"==typeof value.then);var value;if(!0!==result&&!isResultThenable&&!didCallSendResponse)return!1;return(isResultThenable?result:sendResponsePromise).then((msg=>{sendResponse(msg)}),(error=>{let message;message=error&&(error instanceof Error||"string"==typeof error.message)?error.message:"An unexpected error occurred",sendResponse({__mozWebExtensionPolyfillReject__:!0,message})})).catch((err=>{console.error("Failed to send onMessage rejected reply",err)})),!0})),wrappedSendMessageCallback=({reject,resolve},reply)=>{extensionAPIs.runtime.lastError?extensionAPIs.runtime.lastError.message===CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE?resolve():reject(new Error(extensionAPIs.runtime.lastError.message)):reply&&reply.__mozWebExtensionPolyfillReject__?reject(new Error(reply.message)):resolve(reply)},wrappedSendMessage=(name,metadata,apiNamespaceObj,...args)=>{if(args.length<metadata.minArgs)throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);if(args.length>metadata.maxArgs)throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);return new Promise(((resolve,reject)=>{const wrappedCb=wrappedSendMessageCallback.bind(null,{resolve,reject});args.push(wrappedCb),apiNamespaceObj.sendMessage(...args)}))},staticWrappers={devtools:{network:{onRequestFinished:wrapEvent(onRequestFinishedWrappers)}},runtime:{onMessage:wrapEvent(onMessageWrappers),onMessageExternal:wrapEvent(onMessageWrappers),sendMessage:wrappedSendMessage.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:wrappedSendMessage.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},settingMetadata={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return apiMetadata.privacy={network:{"*":settingMetadata},services:{"*":settingMetadata},websites:{"*":settingMetadata}},wrapObject(extensionAPIs,staticWrappers,apiMetadata)};module.exports=wrapAPIs(chrome)}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,[module]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},"./node_modules/webextension-polyfill/dist/browser-polyfill.min.js":function(module,exports){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;"undefined"==typeof globalThis?"undefined"==typeof self||self:globalThis,void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(a){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id?a.exports=globalThis.browser:a.exports=(a=>{const b={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(b).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(a,b=void 0){super(b),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}const e=(b,c)=>(...d)=>{a.runtime.lastError?b.reject(new Error(a.runtime.lastError.message)):c.singleCallbackArg||1>=d.length&&!1!==c.singleCallbackArg?b.resolve(d[0]):b.resolve(d)},f=a=>1==a?"argument":"arguments",g=(a,b)=>function(c,...d){if(d.length<b.minArgs)throw new Error(`Expected at least ${b.minArgs} ${f(b.minArgs)} for ${a}(), got ${d.length}`);if(d.length>b.maxArgs)throw new Error(`Expected at most ${b.maxArgs} ${f(b.maxArgs)} for ${a}(), got ${d.length}`);return new Promise(((f,g)=>{if(b.fallbackToNoCallback)try{c[a](...d,e({resolve:f,reject:g},b))}catch(e){console.warn(`${a} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,e),c[a](...d),b.fallbackToNoCallback=!1,b.noCallback=!0,f()}else b.noCallback?(c[a](...d),f()):c[a](...d,e({resolve:f,reject:g},b))}))},h=(a,b,c)=>new Proxy(b,{apply:(b,d,e)=>c.call(d,a,...e)});let i=Function.call.bind(Object.prototype.hasOwnProperty);const j=(a,b={},c={})=>{let d=Object.create(null),e=Object.create(a);return new Proxy(e,{has:(b,c)=>c in a||c in d,get(e,f){if(f in d)return d[f];if(!(f in a))return;let k=a[f];if("function"==typeof k)if("function"==typeof b[f])k=h(a,a[f],b[f]);else if(i(c,f)){let b=g(f,c[f]);k=h(a,a[f],b)}else k=k.bind(a);else if("object"==typeof k&&null!==k&&(i(b,f)||i(c,f)))k=j(k,b[f],c[f]);else{if(!i(c,"*"))return Object.defineProperty(d,f,{configurable:!0,enumerable:!0,get:()=>a[f],set(b){a[f]=b}}),k;k=j(k,b[f],c["*"])}return d[f]=k,k},set:(b,c,e)=>(c in d?d[c]=e:a[c]=e,!0),defineProperty:(a,b,c)=>Reflect.defineProperty(d,b,c),deleteProperty:(a,b)=>Reflect.deleteProperty(d,b)})},k=a=>({addListener(b,c,...d){b.addListener(a.get(c),...d)},hasListener:(b,c)=>b.hasListener(a.get(c)),removeListener(b,c){b.removeListener(a.get(c))}}),l=new c((a=>"function"==typeof a?function(b){const c=j(b,{},{getContent:{minArgs:0,maxArgs:0}});a(c)}:a)),m=new c((a=>"function"==typeof a?function(b,c,e){let f,g,h=!1,i=new Promise((a=>{f=function(b){h=!0,a(b)}}));try{g=a(b,c,f)}catch(a){g=Promise.reject(a)}const j=!0!==g&&(a=>a&&"object"==typeof a&&"function"==typeof a.then)(g);if(!0!==g&&!j&&!h)return!1;return(a=>{a.then((a=>{e(a)}),(a=>{let b;b=a&&(a instanceof Error||"string"==typeof a.message)?a.message:"An unexpected error occurred",e({__mozWebExtensionPolyfillReject__:!0,message:b})})).catch((a=>{console.error("Failed to send onMessage rejected reply",a)}))})(j?g:i),!0}:a)),n=({reject:b,resolve:c},d)=>{a.runtime.lastError?"The message port closed before a response was received."===a.runtime.lastError.message?c():b(new Error(a.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?b(new Error(d.message)):c(d)},o=(a,b,c,...d)=>{if(d.length<b.minArgs)throw new Error(`Expected at least ${b.minArgs} ${f(b.minArgs)} for ${a}(), got ${d.length}`);if(d.length>b.maxArgs)throw new Error(`Expected at most ${b.maxArgs} ${f(b.maxArgs)} for ${a}(), got ${d.length}`);return new Promise(((a,b)=>{const e=n.bind(null,{resolve:a,reject:b});d.push(e),c.sendMessage(...d)}))},p={devtools:{network:{onRequestFinished:k(l)}},runtime:{onMessage:k(m),onMessageExternal:k(m),sendMessage:o.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:o.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},q={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return b.privacy={network:{"*":q},services:{"*":q},websites:{"*":q}},j(a,p,b)})(chrome)})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,[module]):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),(()=>{"use strict";var browser_polyfill_min=__webpack_require__("./node_modules/webextension-polyfill/dist/browser-polyfill.min.js"),browser_polyfill_min_default=__webpack_require__.n(browser_polyfill_min);const utils_browser_polyfill=__webpack_require__("./node_modules/webextension-polyfill/dist/browser-polyfill.js");function getElementXPath(element){var _a;if(element.nodeType===Node.DOCUMENT_NODE)return"";if(element.nodeType!==Node.ELEMENT_NODE)return getElementXPath(element.parentNode);let ix=0;const siblings=(null===(_a=element.parentNode)||void 0===_a?void 0:_a.childNodes)||[];for(let i=0;i<siblings.length;i++){const sibling=siblings[i];if(sibling===element)return getElementXPath(element.parentNode)+"/"+element.tagName.toLowerCase()+"["+(ix+1)+"]";sibling.nodeType===Node.ELEMENT_NODE&&sibling.tagName===element.tagName&&ix++}return""}function getElementByXPath(xpath){return document.evaluate(xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}var __awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};let hoverOverlay=null,touchStartX=0,touchStartY=0,isTouchMoved=!1,lastHoverTarget=null;function handleMouseMove(event){let target;if(event instanceof MouseEvent)target=event.target;else{const touch=event.changedTouches[0];target=document.elementFromPoint(touch.clientX,touch.clientY)}target.classList.contains("obsidian-highlight-overlay")?function createOrUpdateHoverOverlay(target){if(target===lastHoverTarget)return;lastHoverTarget=target,hoverOverlay||(hoverOverlay=document.createElement("div"),hoverOverlay.id="obsidian-highlight-hover-overlay",document.body.appendChild(hoverOverlay));const rect=target.getBoundingClientRect();hoverOverlay.style.position="absolute",hoverOverlay.style.left=rect.left+window.scrollX-2+"px",hoverOverlay.style.top=rect.top+window.scrollY-2+"px",hoverOverlay.style.width=`${rect.width+4}px`,hoverOverlay.style.height=`${rect.height+4}px`,hoverOverlay.style.display="block",hoverOverlay.classList.add("on-highlight");const index=target.getAttribute("data-highlight-index");index&&document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${index}"]`).forEach((el=>{el.classList.add("is-hovering")}))}(target):removeHoverOverlay()}function handleMouseUp(event){let target;if(event instanceof MouseEvent)target=event.target;else{if(isTouchMoved)return void(isTouchMoved=!1);const touch=event.changedTouches[0];target=document.elementFromPoint(touch.clientX,touch.clientY)}const selection=window.getSelection();selection&&!selection.isCollapsed?handleTextSelection(selection):target.classList.contains("obsidian-highlight-overlay")&&handleHighlightClick(event)}function handleTouchStart(event){const touch=event.touches[0];touchStartX=touch.clientX,touchStartY=touch.clientY,isTouchMoved=!1}function handleTouchMove(event){const touch=event.touches[0];(Math.abs(touch.clientX-touchStartX)>10||Math.abs(touch.clientY-touchStartY)>10)&&(isTouchMoved=!0),handleMouseMove(event)}function updateHighlightListeners(){document.querySelectorAll(".obsidian-highlight-overlay").forEach((highlight=>{highlight.removeEventListener("click",handleHighlightClick),highlight.removeEventListener("touchend",handleHighlightClick),highlight.addEventListener("click",handleHighlightClick),highlight.addEventListener("touchend",handleHighlightClick)}))}function getTextNodesIn(node){const textNodes=[],walker=document.createTreeWalker(node,NodeFilter.SHOW_TEXT,{acceptNode:node=>{var _a;if(node.parentElement){const style=window.getComputedStyle(node.parentElement);if("none"===style.display||"hidden"===style.visibility||"0"===style.opacity||!(null===(_a=node.textContent)||void 0===_a?void 0:_a.trim()))return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}});let currentNode;for(;currentNode=walker.nextNode();)textNodes.push(currentNode);return textNodes}function mapNormalizedPositionToOriginal(originalText,normalizedText,normalizedPosition){let originalPos=0,normalizedPos=0;for(;normalizedPos<normalizedPosition&&originalPos<originalText.length;){for(;originalPos<originalText.length&&(/[\n\r\t]/.test(originalText[originalPos])||/\s/.test(originalText[originalPos])&&originalPos>0&&/\s/.test(originalText[originalPos-1]));)originalPos++;originalPos<originalText.length&&(/\s/.test(originalText[originalPos])&&0!==originalPos&&/\s/.test(originalText[originalPos-1])||normalizedPos++,originalPos++)}for(;originalPos<originalText.length&&/[\s\n\r\t]/.test(originalText[originalPos]);)originalPos++;return originalPos}function normalizeText(text,preserveSpaces=!1){let normalized=text.replace(/[\u2018\u2019\u201B]/g,"'").replace(/[\u201C\u201D\u201E\u201F]/g,'"').replace(/[\u2026]/g,"...").replace(/[\u2013\u2014\u2015]/g,"-").replace(/[\u2017\u2500-\u2587]/g,"-").replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g," ").replace(/[\u200B-\u200F\u202A-\u202E\uFEFF]/g,"");return normalized=normalized.replace(/\s*([.,;:!?])\s*/g,"$1 ").replace(/\s+/g," "),preserveSpaces||(normalized=normalized.replace(/[\n\r\t]+/g," ").replace(/\s+/g," ").trim()),normalized}function planHighlightOverlayRects(searchContainer,target,highlight,index){const existingOverlays=Array.from(document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${index}"]`));if("fragment"===highlight.type)try{const result=findTextInCleanContent(searchContainer,decodeURIComponent(highlight.textStart),highlight.prefix,highlight.suffix);if(result){const rects=result.range.getClientRects();if(rects.length>0){const averageLineHeight=function calculateAverageLineHeight(rects){const heights=Array.from(rects).map((rect=>rect.height));return heights.reduce(((a,b)=>a+b),0)/heights.length}(rects),textRects=Array.from(rects).filter((rect=>rect.height<=1.5*averageLineHeight));if(textRects.length>0)return void mergeHighlightOverlayRects(textRects,highlight.content,existingOverlays,!0,index,highlight.notes)}}console.warn("Could not find text match for fragment highlight:",{text:decodeURIComponent(highlight.textStart),prefix:highlight.prefix?decodeURIComponent(highlight.prefix):void 0,suffix:highlight.suffix?decodeURIComponent(highlight.suffix):void 0})}catch(error){console.error("Error creating fragment highlight overlay:",error)}else if("text"===highlight.type||"complex"===highlight.type||"element"===highlight.type)try{mergeHighlightOverlayRects([target.getBoundingClientRect()],highlight.content,existingOverlays,!1,index,highlight.notes)}catch(error){console.error("Error creating legacy highlight overlay:",error)}}function mergeHighlightOverlayRects(rects,content,existingOverlays,isText=!1,index,notes){let mergedRects=[],currentRect=null;for(let i=0;i<rects.length;i++){const rect=rects[i];currentRect?Math.abs(rect.y-currentRect.y)<1&&Math.abs(rect.height-currentRect.height)<1?currentRect.width=rect.right-currentRect.left:(mergedRects.push(currentRect),currentRect=new DOMRect(rect.x,rect.y,rect.width,rect.height)):currentRect=new DOMRect(rect.x,rect.y,rect.width,rect.height)}currentRect&&mergedRects.push(currentRect);for(const rect of mergedRects)existingOverlays.some((overlay=>{const overlayRect=overlay.getBoundingClientRect();return Math.abs(rect.left-overlayRect.left)<1&&Math.abs(rect.top-overlayRect.top)<1&&Math.abs(rect.width-overlayRect.width)<1&&Math.abs(rect.height-overlayRect.height)<1}))||createHighlightOverlayElement(rect,content,isText,index,notes)}const encodeForTextFragment=str=>encodeURIComponent(str).replace(/-/g,"%2D").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/\./g,"%2E").replace(/'/g,"%E2%80%99").replace(/'/g,"%E2%80%99").replace(/"/g,"%E2%80%9C").replace(/"/g,"%E2%80%9D");function generateTextFragmentString(highlight){const cleanText=decodeURIComponent(highlight.textStart).trim().replace(/\s+/g," "),encodedText=encodeForTextFragment(cleanText),prefix=highlight.prefix?decodeURIComponent(highlight.prefix):void 0,suffix=highlight.suffix?decodeURIComponent(highlight.suffix):void 0,encodedPrefix=prefix?encodeForTextFragment(prefix.trim()):"",encodedSuffix=suffix?encodeForTextFragment(suffix.trim()):"";let fragmentPart=`text=${encodedText}`;return encodedPrefix&&(fragmentPart=`text=${encodedPrefix}-,${encodedText}`),encodedSuffix&&(fragmentPart+=`,${encodedSuffix}`),fragmentPart}function createHighlightOverlayElement(rect,content,isText=!1,index,notes){const overlay=document.createElement("div");overlay.className="obsidian-highlight-overlay",overlay.dataset.highlightIndex=index.toString(),overlay.style.position="absolute",overlay.style.left=rect.left+window.scrollX-2+"px",overlay.style.top=rect.top+window.scrollY-2+"px",overlay.style.width=`${rect.width+4}px`,overlay.style.height=`${rect.height+4}px`,overlay.setAttribute("data-content",content),notes&&notes.length>0&&overlay.setAttribute("data-notes",JSON.stringify(notes));const elementAtPoint=document.elementFromPoint(rect.left,rect.top);elementAtPoint&&function isDarkColor(color){const rgb=color.match(/\d+/g);return!(!rgb||rgb.length<3)&&(299*parseInt(rgb[0])+587*parseInt(rgb[1])+114*parseInt(rgb[2]))/1e3<128}(function getEffectiveBackgroundColor(element){let currentElement=element;for(;currentElement;){const backgroundColor=window.getComputedStyle(currentElement).backgroundColor;if("rgba(0, 0, 0, 0)"!==backgroundColor&&"transparent"!==backgroundColor)return backgroundColor;currentElement=currentElement.parentElement}return"rgb(255, 255, 255)"}(elementAtPoint))&&overlay.classList.add("obsidian-highlight-overlay-dark");const copyButton=document.createElement("button");copyButton.className="copy-url-button",copyButton.innerHTML='\n\t\t<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n\t\t\t<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n\t\t\t<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n\t\t</svg>\n\t\tCopy link\n\t',copyButton.addEventListener("click",(e=>__awaiter(this,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault();try{const highlight=highlights[index];if(highlight&&"fragment"===highlight.type){const url=function createTextFragmentURL(textStart,prefix,suffix){const fragment=`:~:${generateTextFragmentString({type:"fragment",textStart,prefix:prefix?encodeURIComponent(prefix):void 0,suffix:suffix?encodeURIComponent(suffix):void 0,id:"",xpath:"",content:""})}`;return`${window.location.href.split("#")[0]}#${fragment}`}(decodeURIComponent(highlight.textStart),highlight.prefix?decodeURIComponent(highlight.prefix):void 0,highlight.suffix?decodeURIComponent(highlight.suffix):void 0);yield navigator.clipboard.writeText(url),copyButton.classList.add("copied"),copyButton.innerHTML='\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n\t\t\t\t\t\t<path d="M20 6L9 17l-5-5"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\tCopied!\n\t\t\t\t',setTimeout((()=>{copyButton.classList.remove("copied"),copyButton.innerHTML='\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n\t\t\t\t\t\t\t<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n\t\t\t\t\t\t\t<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tCopy link\n\t\t\t\t\t'}),2e3)}}catch(error){console.error("Error copying URL:",error)}})))),overlay.appendChild(copyButton),overlay.addEventListener("click",handleHighlightClick),overlay.addEventListener("touchend",handleHighlightClick),document.body.appendChild(overlay)}function removeExistingHighlightOverlays(index){document.querySelectorAll(`.obsidian-highlight-overlay[data-highlight-index="${index}"]`).forEach((el=>el.remove()))}const throttledUpdateHighlights=function throttle(func,limit){let inThrottle;return function(...args){inThrottle||(func.apply(this,args),inThrottle=!0,setTimeout((()=>inThrottle=!1),limit))}}((()=>{isApplyingHighlights||function updateHighlightOverlayPositions(){const isInReader=document.documentElement.classList.contains("obsidian-reader-active");let searchContainer;searchContainer=isInReader&&document.querySelector(".obsidian-reader-content article")||document.body,searchContainer?highlights.forEach(((highlight,index)=>{let targetElement=null;targetElement="fragment"===highlight.type?searchContainer:getElementByXPath(highlight.xpath),targetElement?(removeExistingHighlightOverlays(index),planHighlightOverlayRects(searchContainer,targetElement,highlight,index)):"fragment"!==highlight.type&&console.warn(`Element not found for XPath during update: ${highlight.xpath}`)})):console.warn("Could not find container for updating highlight positions")}()}),100);function removeHoverOverlay(){hoverOverlay&&(hoverOverlay.style.display="none"),lastHoverTarget=null,document.querySelectorAll(".obsidian-highlight-overlay.is-hovering").forEach((el=>{el.classList.remove("is-hovering")}))}function handleHighlightClick(event){return __awaiter(this,void 0,void 0,(function*(){event.stopPropagation(),event.preventDefault();const overlay=event.currentTarget;try{if(!overlay||!overlay.dataset)return;const index=overlay.dataset.highlightIndex;if(void 0===index)return void console.warn("No highlight index found on clicked element");const highlightIndex=parseInt(index);if(isNaN(highlightIndex)||highlightIndex<0||highlightIndex>=highlights.length)return void console.warn(`Invalid highlight index: ${index}`);const highlightToRemove=highlights[highlightIndex];!function updateHighlights(newHighlights){const oldHighlights=[...highlights];highlights=newHighlights,addToHistory("add",oldHighlights,newHighlights),notifyHighlightsUpdated()}(highlights.filter((h=>h.id!==highlightToRemove.id))),removeExistingHighlightOverlays(highlightIndex),sortHighlights(),applyHighlights(),saveHighlights(),updateHighlighterMenu(),notifyHighlightsUpdated()}catch(error){console.error("Error handling highlight click:",error)}}))}function removeExistingHighlights(){const existingHighlights=document.querySelectorAll(".obsidian-highlight-overlay");existingHighlights.length>0&&existingHighlights.forEach((el=>el.remove()))}function fuzzyMatch(text1,text2,threshold=.8){if(text1===text2)return!0;text1=text1.toLowerCase(),text2=text2.toLowerCase();const m=text1.length,n=text2.length,dp=Array(m+1).fill(null).map((()=>Array(n+1).fill(0)));for(let i=0;i<=m;i++)dp[i][0]=i;for(let j=0;j<=n;j++)dp[0][j]=j;for(let i=1;i<=m;i++)for(let j=1;j<=n;j++)dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+(text1[i-1]===text2[j-1]?0:1));const maxLength=Math.max(text1.length,text2.length);return 1-dp[m][n]/maxLength>=threshold}function findTextInCleanContent(container,searchText,prefix,suffix,retryCount=0){var _a,_b,_c;const CONTEXT_SIZES=[20,40,60],SIMILARITY_THRESHOLDS=[.9,.8,.7],textNodes=getTextNodesIn(container),nodesByParagraph=new Map;for(const node of textNodes){const paragraph=(null===(_a=node.parentElement)||void 0===_a?void 0:_a.closest("p, div, li, blockquote, pre, h1, h2, h3, h4, h5, h6, article, section"))||container;nodesByParagraph.has(paragraph)||nodesByParagraph.set(paragraph,[]),null===(_b=nodesByParagraph.get(paragraph))||void 0===_b||_b.push(node)}const contextSize=CONTEXT_SIZES[Math.min(retryCount,CONTEXT_SIZES.length-1)],similarityThreshold=SIMILARITY_THRESHOLDS[Math.min(retryCount,SIMILARITY_THRESHOLDS.length-1)];for(const[paragraph,nodes]of nodesByParagraph){let fullText="";const nodePositions=[];for(const node of nodes){const nodeText=node.textContent||"";nodePositions.push({node,start:fullText.length,end:fullText.length+nodeText.length}),fullText+=nodeText}if(!fullText.trim())continue;const normalizedFullText=normalizeText(fullText),normalizedSearchText=searchText;let startIndex=-1,currentIndex=0;for(;-1!==(currentIndex=normalizedFullText.indexOf(normalizedSearchText,currentIndex));){let contextMatches=!0;if(prefix||suffix){const decodedPrefix=prefix?normalizeText(decodeURIComponent(prefix)):"",decodedSuffix=suffix?normalizeText(decodeURIComponent(suffix)):"",beforeContext=normalizedFullText.slice(Math.max(0,currentIndex-contextSize),currentIndex),afterContext=normalizedFullText.slice(currentIndex+normalizedSearchText.length,currentIndex+normalizedSearchText.length+contextSize);if(prefix){const prefixEndMatches=beforeContext.endsWith(decodedPrefix),prefixFuzzyMatches=!prefixEndMatches&&fuzzyMatch(beforeContext,decodedPrefix,similarityThreshold);prefixEndMatches||prefixFuzzyMatches||(contextMatches=!1)}if(suffix&&contextMatches){const suffixStartMatches=afterContext.startsWith(decodedSuffix),suffixFuzzyMatches=!suffixStartMatches&&fuzzyMatch(afterContext,decodedSuffix,similarityThreshold);suffixStartMatches||suffixFuzzyMatches||(contextMatches=!1)}}if(contextMatches){startIndex=currentIndex;break}currentIndex+=1}if(-1===startIndex)continue;const originalStartIndex=mapNormalizedPositionToOriginal(fullText,0,startIndex),originalEndIndex=mapNormalizedPositionToOriginal(fullText,0,startIndex+normalizedSearchText.length);let startNodeResult=null,endNodeResult=null;for(const{node,start,end}of nodePositions)if(!startNodeResult&&originalStartIndex>=start&&originalStartIndex<end&&(startNodeResult={node,offset:originalStartIndex-start}),originalEndIndex>start&&originalEndIndex<=end&&(endNodeResult={node,offset:originalEndIndex-start},startNodeResult))break;if(endNodeResult&&0===endNodeResult.offset&&(!startNodeResult||startNodeResult.node!==endNodeResult.node)){const endIndex=nodePositions.findIndex((p=>p.node===endNodeResult.node));if(endIndex>0){const prevNodePos=nodePositions[endIndex-1];endNodeResult={node:prevNodePos.node,offset:(null===(_c=prevNodePos.node.textContent)||void 0===_c?void 0:_c.length)||0}}}if(startNodeResult&&endNodeResult)try{const range=document.createRange();range.setStart(startNodeResult.node,startNodeResult.offset),range.setEnd(endNodeResult.node,endNodeResult.offset);const rangeText=range.toString(),normalizedRangeText=normalizeText(rangeText);if(fuzzyMatch(normalizedRangeText,normalizedSearchText,similarityThreshold))return{range,cleanText:fullText};console.warn("Range content mismatch after mapping:",{expectedNormalized:normalizedSearchText,actualNormalized:normalizedRangeText,actualOriginal:rangeText,similarity:fuzzyMatch(normalizedRangeText,normalizedSearchText,0)})}catch(error){console.error("Error creating range:",error,{startNode:null==startNodeResult?void 0:startNodeResult.node,startOffset:null==startNodeResult?void 0:startNodeResult.offset,endNode:null==endNodeResult?void 0:endNodeResult.node,endOffset:null==endNodeResult?void 0:endNodeResult.offset})}}return retryCount<2?findTextInCleanContent(container,searchText,prefix,suffix,retryCount+1):null}window.addEventListener("resize",throttledUpdateHighlights),window.addEventListener("scroll",throttledUpdateHighlights),new MutationObserver((mutations=>{isApplyingHighlights||mutations.some((mutation=>"childList"===mutation.type&&mutation.target instanceof Element&&!mutation.target.id.startsWith("obsidian-highlight")||"attributes"===mutation.type&&("style"===mutation.attributeName||"class"===mutation.attributeName)&&mutation.target instanceof Element&&!mutation.target.id.startsWith("obsidian-highlight")))&&throttledUpdateHighlights()})).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"],characterData:!1});var browser_detection_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function detectBrowser(){return browser_detection_awaiter(this,void 0,void 0,(function*(){try{if("undefined"==typeof window||!window)return"undefined"!=typeof browser?"firefox":"undefined"!=typeof chrome?"chrome":"other";if(void 0!==window.KAGI)return"orion";const userAgent=navigator.userAgent.toLowerCase();if(userAgent.includes("firefox"))return userAgent.includes("mobile")?"firefox-mobile":"firefox";if(userAgent.indexOf("edg/")>-1)return"edge";if(userAgent.indexOf("chrome")>-1){const nav=navigator;return nav.brave&&(yield nav.brave.isBrave())?"brave":"chrome"}return userAgent.includes("safari")?function isIPad(){return navigator.userAgent.includes("iPad")||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}()?"ipad-os":userAgent.includes("mobile")||userAgent.includes("iphone")?"mobile-safari":"safari":"other"}catch(error){return console.error("Error detecting browser:",error),"other"}}))}const debugLog=(filterName,...args)=>{};var storage_utils_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};let generalSettings={vaults:[],betaFeatures:!1,legacyMode:!1,silentOpen:!1,highlighterEnabled:!0,alwaysShowHighlights:!1,highlightBehavior:"highlight-inline",showMoreActionsButton:!1,interpreterModel:"",models:[],providers:[],interpreterEnabled:!1,interpreterAutoRun:!1,defaultPromptContext:"",propertyTypes:[],readerSettings:{fontSize:1.5,lineHeight:1.6,maxWidth:38,theme:"default",themeMode:"auto"},stats:{addToObsidian:0,saveFile:0,copyToClipboard:0,share:0},history:[],ratings:[],saveBehavior:"addToObsidian"};const CURRENT_MIGRATION_VERSION=1;function loadSettings(){return storage_utils_awaiter(this,void 0,void 0,(function*(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9;const data=yield utils_browser_polyfill.storage.sync.get(null),defaultSettings={vaults:[],showMoreActionsButton:!1,betaFeatures:!1,legacyMode:!1,silentOpen:!1,highlighterEnabled:!0,alwaysShowHighlights:!0,highlightBehavior:"highlight-inline",interpreterModel:"",models:[],providers:[],interpreterEnabled:!1,interpreterAutoRun:!1,defaultPromptContext:"",propertyTypes:[],saveBehavior:"addToObsidian",readerSettings:{fontSize:1.5,lineHeight:1.6,maxWidth:38,theme:"default",themeMode:"auto"},stats:{addToObsidian:0,saveFile:0,copyToClipboard:0,share:0},history:[],ratings:[]};(!data.migrationVersion||data.migrationVersion<CURRENT_MIGRATION_VERSION)&&(yield utils_browser_polyfill.storage.sync.set({migrationVersion:CURRENT_MIGRATION_VERSION}),debugLog("Settings",`Updated migration version to ${CURRENT_MIGRATION_VERSION}`));const loadedSettings={vaults:data.vaults||defaultSettings.vaults,showMoreActionsButton:null!==(_b=null===(_a=data.general_settings)||void 0===_a?void 0:_a.showMoreActionsButton)&&void 0!==_b?_b:defaultSettings.showMoreActionsButton,betaFeatures:null!==(_d=null===(_c=data.general_settings)||void 0===_c?void 0:_c.betaFeatures)&&void 0!==_d?_d:defaultSettings.betaFeatures,legacyMode:null!==(_f=null===(_e=data.general_settings)||void 0===_e?void 0:_e.legacyMode)&&void 0!==_f?_f:defaultSettings.legacyMode,silentOpen:null!==(_h=null===(_g=data.general_settings)||void 0===_g?void 0:_g.silentOpen)&&void 0!==_h?_h:defaultSettings.silentOpen,highlighterEnabled:null!==(_k=null===(_j=data.highlighter_settings)||void 0===_j?void 0:_j.highlighterEnabled)&&void 0!==_k?_k:defaultSettings.highlighterEnabled,alwaysShowHighlights:null!==(_m=null===(_l=data.highlighter_settings)||void 0===_l?void 0:_l.alwaysShowHighlights)&&void 0!==_m?_m:defaultSettings.alwaysShowHighlights,highlightBehavior:null!==(_p=null===(_o=data.highlighter_settings)||void 0===_o?void 0:_o.highlightBehavior)&&void 0!==_p?_p:defaultSettings.highlightBehavior,interpreterModel:(null===(_q=data.interpreter_settings)||void 0===_q?void 0:_q.interpreterModel)||defaultSettings.interpreterModel,models:(null===(_r=data.interpreter_settings)||void 0===_r?void 0:_r.models)||defaultSettings.models,providers:(null===(_s=data.interpreter_settings)||void 0===_s?void 0:_s.providers)||defaultSettings.providers,interpreterEnabled:null!==(_u=null===(_t=data.interpreter_settings)||void 0===_t?void 0:_t.interpreterEnabled)&&void 0!==_u?_u:defaultSettings.interpreterEnabled,interpreterAutoRun:null!==(_w=null===(_v=data.interpreter_settings)||void 0===_v?void 0:_v.interpreterAutoRun)&&void 0!==_w?_w:defaultSettings.interpreterAutoRun,defaultPromptContext:(null===(_x=data.interpreter_settings)||void 0===_x?void 0:_x.defaultPromptContext)||defaultSettings.defaultPromptContext,propertyTypes:data.property_types||defaultSettings.propertyTypes,readerSettings:{fontSize:null!==(_z=null===(_y=data.reader_settings)||void 0===_y?void 0:_y.fontSize)&&void 0!==_z?_z:defaultSettings.readerSettings.fontSize,lineHeight:null!==(_1=null===(_0=data.reader_settings)||void 0===_0?void 0:_0.lineHeight)&&void 0!==_1?_1:defaultSettings.readerSettings.lineHeight,maxWidth:null!==(_3=null===(_2=data.reader_settings)||void 0===_2?void 0:_2.maxWidth)&&void 0!==_3?_3:defaultSettings.readerSettings.maxWidth,theme:null!==(_5=null===(_4=data.reader_settings)||void 0===_4?void 0:_4.theme)&&void 0!==_5?_5:defaultSettings.readerSettings.theme,themeMode:null!==(_7=null===(_6=data.reader_settings)||void 0===_6?void 0:_6.themeMode)&&void 0!==_7?_7:defaultSettings.readerSettings.themeMode},stats:data.stats||defaultSettings.stats,history:data.history||defaultSettings.history,ratings:data.ratings||defaultSettings.ratings,saveBehavior:null!==(_9=null===(_8=data.general_settings)||void 0===_8?void 0:_8.saveBehavior)&&void 0!==_9?_9:defaultSettings.saveBehavior};return generalSettings=loadedSettings,debugLog("Settings","Loaded settings:",generalSettings),generalSettings}))}window.debugStorage=key=>key?utils_browser_polyfill.storage.sync.get(key).then((data=>(console.log(`Sync storage contents for key "${key}":`,data),data))):utils_browser_polyfill.storage.sync.get(null).then((data=>(console.log("Sync storage contents:",data),data)));var highlighter_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};let highlights=[],isApplyingHighlights=!1,lastAppliedHighlights="",originalLinkClickHandlers=new WeakMap,highlightHistory=[],redoHistory=[];const MAX_HISTORY_LENGTH=30;function toggleHighlighterMenu(isActive){document.body.classList.toggle("obsidian-highlighter-active",isActive),isActive?(document.addEventListener("mouseup",handleMouseUp),document.addEventListener("mousemove",handleMouseMove),document.addEventListener("touchstart",handleTouchStart),document.addEventListener("touchmove",handleTouchMove),document.addEventListener("touchend",handleMouseUp),document.addEventListener("keydown",handleKeyDown),function disableLinkClicks(){document.querySelectorAll("a").forEach((link=>{const existingHandler=link.onclick;existingHandler&&originalLinkClickHandlers.set(link,existingHandler),link.onclick=e=>{e.preventDefault(),e.stopPropagation()}}))}(),createHighlighterMenu(),function addBrowserClassToHtml(){browser_detection_awaiter(this,void 0,void 0,(function*(){const browser=yield detectBrowser(),htmlElement=document.documentElement;switch(htmlElement.classList.remove("is-firefox-mobile","is-chromium","is-firefox","is-edge","is-chrome","is-brave","is-safari","is-mobile-safari","is-ipad-os","is-orion"),browser){case"firefox-mobile":htmlElement.classList.add("is-mobile","is-firefox-mobile","is-firefox");break;case"firefox":htmlElement.classList.add("is-firefox");break;case"edge":htmlElement.classList.add("is-chromium","is-edge");break;case"chrome":htmlElement.classList.add("is-chromium","is-chrome");break;case"brave":htmlElement.classList.add("is-chromium","is-brave");break;case"safari":htmlElement.classList.add("is-safari");break;case"mobile-safari":htmlElement.classList.add("is-mobile","is-mobile-safari","is-safari","is-ios");break;case"ipad-os":htmlElement.classList.add("is-tablet","is-ipad-os","is-safari");break;case"orion":htmlElement.classList.add("is-orion")}}))}(),utils_browser_polyfill.runtime.sendMessage({action:"highlighterModeChanged",isActive:!0}),applyHighlights()):(document.removeEventListener("mouseup",handleMouseUp),document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("touchstart",handleTouchStart),document.removeEventListener("touchmove",handleTouchMove),document.removeEventListener("touchend",handleMouseUp),document.removeEventListener("keydown",handleKeyDown),removeHoverOverlay(),function enableLinkClicks(){document.querySelectorAll("a").forEach((link=>{const originalHandler=originalLinkClickHandlers.get(link);originalHandler?(link.onclick=originalHandler,originalLinkClickHandlers.delete(link)):link.onclick=null}))}(),removeHighlighterMenu(),utils_browser_polyfill.runtime.sendMessage({action:"highlighterModeChanged",isActive:!1}),generalSettings.alwaysShowHighlights||removeExistingHighlights()),updateHighlightListeners()}function canUndo(){return highlightHistory.length>0}function canRedo(){return redoHistory.length>0}function undo(){if(canUndo()){const lastAction=highlightHistory.pop();lastAction&&(redoHistory.push(lastAction),highlights=[...lastAction.oldHighlights],applyHighlights(),saveHighlights(),updateHighlighterMenu(),updateUndoRedoButtons(),notifyHighlightsUpdated())}}function redo(){if(canRedo()){const nextAction=redoHistory.pop();nextAction&&(highlightHistory.push(nextAction),highlights=[...nextAction.newHighlights],applyHighlights(),saveHighlights(),updateHighlighterMenu(),updateUndoRedoButtons(),notifyHighlightsUpdated())}}function updateUndoRedoButtons(){const undoButton=document.getElementById("obsidian-undo-highlights"),redoButton=document.getElementById("obsidian-redo-highlights");undoButton&&(undoButton.classList.toggle("active",canUndo()),undoButton.setAttribute("aria-disabled",(!canUndo()).toString())),redoButton&&(redoButton.classList.toggle("active",canRedo()),redoButton.setAttribute("aria-disabled",(!canRedo()).toString()))}function handleClipButtonClick(e){return highlighter_awaiter(this,void 0,void 0,(function*(){e.preventDefault();const browserType=yield detectBrowser();try{const response=yield utils_browser_polyfill.runtime.sendMessage({action:"openPopup"});if(!response||"object"!=typeof response||!("success"in response))throw new Error("Invalid response from background script");if(!response.success)throw new Error(response.error||"Unknown error")}catch(error){console.error("Error opening popup:",error),"firefox"===browserType?alert("Additional permissions required. To open Web Clipper from the highlighter, go to about:config and set this to true:\n\nextensions.openPopupWithoutUserGesture.enabled"):console.error("Failed to open popup:",error)}}))}function createHighlighterMenu(){let menu=document.querySelector(".obsidian-highlighter-menu");menu||(menu=document.createElement("div"),menu.className="obsidian-highlighter-menu",document.body.appendChild(menu));const highlightCount=highlights.length,highlightText=`${highlightCount}`;if(menu.innerHTML=`\n\t\t${highlightCount>0?'<button id="obsidian-clip-button" class="mod-cta">Clip highlights</button>':'<span class="no-highlights">Select elements to highlight</span>'}\n\t\t${highlightCount>0?`<button id="obsidian-clear-highlights">${highlightText} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg></button>`:""}\n\t\t${highlightCount>0?'<button id="obsidian-copy-all-links"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button>':""}\n\t\t<button id="obsidian-undo-highlights"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-undo-2"><path d="M9 14 4 9l5-5"/><path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"/></svg></button>\n\t\t<button id="obsidian-redo-highlights"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-redo-2"><path d="m15 14 5-5-5-5"/><path d="M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13"/></svg></button>\n\t\t<button id="obsidian-exit-highlighter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\t\n\t`,highlightCount>0){const clearButton=document.getElementById("obsidian-clear-highlights"),clipButton=document.getElementById("obsidian-clip-button"),copyAllButton=document.getElementById("obsidian-copy-all-links");clearButton&&(clearButton.addEventListener("click",clearHighlights),clearButton.addEventListener("touchend",(e=>{e.preventDefault(),clearHighlights()}))),clipButton&&(clipButton.addEventListener("click",handleClipButtonClick),clipButton.addEventListener("touchend",(e=>{e.preventDefault(),handleClipButtonClick(e)}))),copyAllButton&&(copyAllButton.addEventListener("click",handleCopyAllHighlightsLink),copyAllButton.addEventListener("touchend",(e=>{e.preventDefault(),handleCopyAllHighlightsLink()})))}const exitButton=document.getElementById("obsidian-exit-highlighter"),undoButton=document.getElementById("obsidian-undo-highlights"),redoButton=document.getElementById("obsidian-redo-highlights");exitButton&&(exitButton.addEventListener("click",exitHighlighterMode),exitButton.addEventListener("touchend",(e=>{e.preventDefault(),exitHighlighterMode()}))),undoButton&&(undoButton.addEventListener("click",undo),undoButton.addEventListener("touchend",(e=>{e.preventDefault(),undo()}))),redoButton&&(redoButton.addEventListener("click",redo),redoButton.addEventListener("touchend",(e=>{e.preventDefault(),redo()}))),updateUndoRedoButtons()}function removeHighlighterMenu(){const menu=document.querySelector(".obsidian-highlighter-menu");menu&&menu.remove()}function createAndAddHighlightForRange(range,notes){return highlighter_awaiter(this,void 0,void 0,(function*(){var _a,_b;try{const selectedText=range.toString();if(!selectedText.trim())return!1;let container=range.commonAncestorContainer;if(container.nodeType===Node.TEXT_NODE&&(container=container.parentElement),!(container&&container instanceof Element))return!1;const textNodes=getTextNodesIn(container);let fullText="";const nodePositions=[];for(const node of textNodes){const nodeText=node.textContent||"";nodePositions.push({node,start:fullText.length,end:fullText.length+nodeText.length}),fullText+=nodeText}let absoluteStart=-1,absoluteEnd=-1;for(const{node,start}of nodePositions){if(node===range.startContainer){absoluteStart=start+range.startOffset;break}if(range.startContainer.contains(node)&&range.startContainer!==node){const walker=document.createTreeWalker(range.startContainer,NodeFilter.SHOW_TEXT);let foundNode,offsetWithinContainer=0;for(;foundNode=walker.nextNode();){if(node===foundNode){absoluteStart=start+range.startOffset-offsetWithinContainer;break}offsetWithinContainer+=(null===(_a=foundNode.textContent)||void 0===_a?void 0:_a.length)||0}if(-1!==absoluteStart)break}}for(const{node,start}of nodePositions){if(node===range.endContainer){absoluteEnd=start+range.endOffset;break}if(range.endContainer.contains(node)&&range.endContainer!==node){const walker=document.createTreeWalker(range.endContainer,NodeFilter.SHOW_TEXT);let foundNode,offsetWithinContainer=0;for(;foundNode=walker.nextNode();){const nodeLength=(null===(_b=foundNode.textContent)||void 0===_b?void 0:_b.length)||0;if(node===foundNode&&range.endOffset>=offsetWithinContainer&&range.endOffset<=offsetWithinContainer+nodeLength){absoluteEnd=start+range.endOffset-offsetWithinContainer;break}offsetWithinContainer+=nodeLength}if(-1!==absoluteEnd)break}}if(-1===absoluteStart||-1===absoluteEnd||absoluteStart>absoluteEnd||fullText.slice(absoluteStart,absoluteEnd)!==selectedText){const normalizedFullText=normalizeText(fullText),normalizedSelectedText=normalizeText(selectedText),foundIndex=normalizedFullText.indexOf(normalizedSelectedText);if(-1===foundIndex)return!1;absoluteStart=highlighter_mapNormalizedPositionToOriginal(fullText,normalizedFullText,foundIndex),absoluteEnd=highlighter_mapNormalizedPositionToOriginal(fullText,normalizedFullText,foundIndex+normalizedSelectedText.length)}const contextSize=20,prefix=fullText.substring(Math.max(0,absoluteStart-contextSize),absoluteStart),suffix=fullText.substring(absoluteEnd,Math.min(fullText.length,absoluteEnd+contextSize)),normalizedSelectedText=normalizeText(selectedText),highlight={id:Date.now().toString()+Math.random().toString(16).slice(2),type:"fragment",xpath:getElementXPath(container),content:selectedText,textStart:encodeURIComponent(normalizedSelectedText),prefix:prefix?encodeURIComponent(prefix):void 0,suffix:suffix?encodeURIComponent(suffix):void 0,notes};let findResult=findTextInCleanContent(container,normalizedSelectedText,highlight.prefix,highlight.suffix);return findResult||(findResult=findTextInCleanContent(document.body,normalizedSelectedText,highlight.prefix,highlight.suffix)),!!findResult&&(addHighlight(highlight),!0)}catch(error){return!1}}))}function handleTextSelection(selection,notes){return highlighter_awaiter(this,void 0,void 0,(function*(){var _a,_b;if(console.log("\u{1f3af} Selection:",selection.toString().slice(0,100)+"..."),!selection||0===selection.rangeCount)return;const range=selection.getRangeAt(0);if(!range.collapsed)try{const startNode=range.startContainer,endNode=range.endContainer,commonAncestor=range.commonAncestorContainer,blockSelector="p, li, blockquote, pre, h1, h2, h3, h4, h5, h6, div:not(.obsidian-highlighter-menu):not(#obsidian-highlight-hover-overlay)",startBlock=null===(_a=startNode.nodeType===Node.ELEMENT_NODE?startNode:startNode.parentElement)||void 0===_a?void 0:_a.closest(blockSelector),endBlock=null===(_b=endNode.nodeType===Node.ELEMENT_NODE?endNode:endNode.parentElement)||void 0===_b?void 0:_b.closest(blockSelector);if(startBlock&&endBlock&&startBlock!==endBlock){const highlightsToAdd=[],walker=document.createTreeWalker(commonAncestor,NodeFilter.SHOW_ELEMENT,{acceptNode:node=>{if(!(node instanceof Element&&node.matches(blockSelector)))return NodeFilter.FILTER_SKIP;const nodeRange=document.createRange();return nodeRange.selectNodeContents(node),range.compareBoundaryPoints(Range.END_TO_START,nodeRange)<=0&&range.compareBoundaryPoints(Range.START_TO_END,nodeRange)>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});if(startBlock&&commonAncestor.contains(startBlock))walker.currentNode=startBlock;else{let firstNode=walker.firstChild();for(;firstNode&&!range.intersectsNode(firstNode);)firstNode=walker.nextNode();walker.currentNode=firstNode||commonAncestor}let currentNode=walker.currentNode,blockIndex=0;for(;currentNode;){if(!(currentNode instanceof Element)){currentNode=walker.nextNode();continue}const currentBlock=currentNode,intersectionRange=range.cloneRange(),blockBoundaryRange=document.createRange();if(blockBoundaryRange.selectNodeContents(currentBlock),intersectionRange.compareBoundaryPoints(Range.START_TO_START,blockBoundaryRange)<0&&intersectionRange.setStart(blockBoundaryRange.startContainer,blockBoundaryRange.startOffset),intersectionRange.compareBoundaryPoints(Range.END_TO_END,blockBoundaryRange)>0&&intersectionRange.setEnd(blockBoundaryRange.endContainer,blockBoundaryRange.endOffset),!intersectionRange.collapsed&&intersectionRange.toString().trim().length>0&&highlightsToAdd.push(intersectionRange),currentBlock===endBlock||currentBlock.contains(endBlock))break;currentNode=walker.nextNode(),blockIndex++}if(highlightsToAdd.length>0){let successCount=0;successCount=(yield Promise.all(highlightsToAdd.map((hr=>createAndAddHighlightForRange(hr,notes))))).filter(Boolean).length}selection.removeAllRanges()}else yield createAndAddHighlightForRange(range,notes),selection.removeAllRanges()}catch(error){console.error("[Main] Error handling text selection:",error),selection&&selection.removeAllRanges()}}))}function addHighlight(highlight){console.log("\u2795 Adding new highlight:",{type:highlight.type,content:highlight.content.slice(0,100)+(highlight.content.length>100?"...":""),xpath:highlight.xpath,hasNotes:!!highlight.notes&&highlight.notes.length>0});const oldHighlights=[...highlights],mergedHighlights=function mergeOverlappingHighlights(existingHighlights,newHighlight){let mergedHighlights=[],consumedNew=!1;for(const existing of existingHighlights){let overlap=!1,mergedResult=null;if("fragment"===existing.type&&"fragment"===newHighlight.type&&existing.xpath===newHighlight.xpath){if(analyzeHighlightOverlap(existing,newHighlight).overlaps){overlap=!0,mergedResult=mergeHighlights(existing,newHighlight);const combinedNotes=Array.from(new Set([...existing.notes||[],...newHighlight.notes||[]]));mergedResult&&(mergedResult.notes=combinedNotes.length>0?combinedNotes:void 0)}}else if(existing.xpath===newHighlight.xpath&&("fragment"!==existing.type||"fragment"!==newHighlight.type)){overlap=!0,mergedResult=mergeComplexHighlights(existing,newHighlight);const combinedNotes=Array.from(new Set([...existing.notes||[],...newHighlight.notes||[]]));mergedResult&&(mergedResult.notes=combinedNotes.length>0?combinedNotes:void 0)}if(overlap&&mergedResult){if(mergedHighlights.length>0){const lastAdded=mergedHighlights[mergedHighlights.length-1];let subsequentOverlap=!1,subsequentMergedResult=null;if("fragment"===lastAdded.type&&"fragment"===mergedResult.type&&lastAdded.xpath===mergedResult.xpath){if(analyzeHighlightOverlap(lastAdded,mergedResult).overlaps){subsequentOverlap=!0,subsequentMergedResult=mergeHighlights(lastAdded,mergedResult);const combinedNotes=Array.from(new Set([...lastAdded.notes||[],...mergedResult.notes||[]]));subsequentMergedResult&&(subsequentMergedResult.notes=combinedNotes.length>0?combinedNotes:void 0)}}else if(lastAdded.xpath===mergedResult.xpath&&("fragment"!==lastAdded.type||"fragment"!==mergedResult.type)){subsequentOverlap=!0,subsequentMergedResult=mergeComplexHighlights(lastAdded,mergedResult);const combinedNotes=Array.from(new Set([...lastAdded.notes||[],...mergedResult.notes||[]]));subsequentMergedResult&&(subsequentMergedResult.notes=combinedNotes.length>0?combinedNotes:void 0)}subsequentOverlap&&subsequentMergedResult?mergedHighlights[mergedHighlights.length-1]=subsequentMergedResult:mergedHighlights.push(mergedResult)}else mergedHighlights.push(mergedResult);consumedNew=!0}else mergedHighlights.push(existing)}return consumedNew||(console.log("Adding new highlight without merging"),mergedHighlights.push(newHighlight)),mergedHighlights}(highlights,highlight);highlights=mergedHighlights,addToHistory("add",oldHighlights,mergedHighlights),sortHighlights(),applyHighlights(),saveHighlights(),updateHighlighterMenu(),notifyHighlightsUpdated()}function sortHighlights(){highlights.sort(((a,b)=>{const elementA=getElementByXPath(a.xpath),elementB=getElementByXPath(b.xpath);if(elementA&&elementB){const verticalDiff=getElementVerticalPosition(elementA)-getElementVerticalPosition(elementB);return 0===verticalDiff?"text"===a.type&&"text"===b.type&&a.xpath===b.xpath?a.startOffset-b.startOffset:elementA.getBoundingClientRect().left-elementB.getBoundingClientRect().left:verticalDiff}return 0}))}function getElementVerticalPosition(element){return element.getBoundingClientRect().top+window.scrollY}function analyzeHighlightOverlap(highlight1,highlight2){if(highlight1.xpath!==highlight2.xpath)return{overlaps:!1,position:0};const element=getElementByXPath(highlight1.xpath);if(!element)return{overlaps:!1,position:0};const normalizedText=normalizeText(element.textContent||""),text1=decodeURIComponent(highlight1.textStart),text2=decodeURIComponent(highlight2.textStart),start1=normalizedText.indexOf(normalizeText(text1)),end1=start1+text1.length,start2=normalizedText.indexOf(normalizeText(text2)),end2=start2+text2.length;return console.log("Analyzing overlap:",{text1,text2,start1,end1,start2,end2}),Math.abs(end1-start2)<=1||Math.abs(end2-start1)<=1?{overlaps:!0,type:"adjacent",position:Math.min(start1,start2)}:start2<=start1&&end2>=end1?{overlaps:!0,type:"encompasses",position:start2}:start2<start1&&end2>=start1&&end2<=end1?{overlaps:!0,type:"extends-start",position:start2}:start2<=end1&&end2>end1&&start2>=start1?{overlaps:!0,type:"extends-end",position:start1}:{overlaps:!1,position:0}}function mergeHighlights(highlight1,highlight2){if("fragment"!==highlight1.type||"fragment"!==highlight2.type){const merged=mergeComplexHighlights(highlight1,highlight2),combinedNotes=Array.from(new Set([...highlight1.notes||[],...highlight2.notes||[]]));return merged&&(merged.notes=combinedNotes.length>0?combinedNotes:void 0),merged}const overlap=analyzeHighlightOverlap(highlight1,highlight2);if(console.log("Merge analysis:",overlap),!overlap.overlaps)return null;const element=getElementByXPath(highlight1.xpath);if(!element)return null;const text1=decodeURIComponent(highlight1.textStart),text2=decodeURIComponent(highlight2.textStart),range1Result=findTextInCleanContent(element,text1,highlight1.prefix,highlight1.suffix),range2Result=findTextInCleanContent(element,text2,highlight2.prefix,highlight2.suffix);if(!range1Result||!range2Result)return console.warn("Could not find original ranges for merging highlights. Aborting merge."),highlight1.content.length>highlight2.content.length?highlight1:highlight2;const range1=range1Result.range,range2=range2Result.range,mergedRange=document.createRange(),startsBefore=range1.compareBoundaryPoints(Range.START_TO_START,range2)<=0,endsAfter=range1.compareBoundaryPoints(Range.END_TO_END,range2)>=0;mergedRange.setStart(startsBefore?range1.startContainer:range2.startContainer,startsBefore?range1.startOffset:range2.startOffset),mergedRange.setEnd(endsAfter?range1.endContainer:range2.endContainer,endsAfter?range1.endOffset:range2.endOffset);const mergedHighlightData=function createSingleParagraphHighlight(range){var _a,_b;const fragment=range.cloneContents(),tempDiv=document.createElement("div");tempDiv.appendChild(fragment);const textContent=tempDiv.textContent||"";if(!textContent.trim())return null;const prefixNode=null===(_a=range.startContainer.textContent)||void 0===_a?void 0:_a.slice(Math.max(0,range.startOffset-20),range.startOffset),suffixNode=null===(_b=range.endContainer.textContent)||void 0===_b?void 0:_b.slice(range.endOffset,range.endOffset+20);let commonAncestor=range.commonAncestorContainer;if(commonAncestor.nodeType!==Node.ELEMENT_NODE&&(commonAncestor=commonAncestor.parentElement),!commonAncestor)return null;const textStart=encodeURIComponent(textContent),prefix=prefixNode?encodeURIComponent(prefixNode):void 0,suffix=suffixNode?encodeURIComponent(suffixNode):void 0,highlight={type:"fragment",xpath:getElementXPath(commonAncestor),content:textContent,id:Date.now().toString(),textStart,prefix,suffix};return function testHighlightFindability(highlight){return null!==findTextInCleanContent(document.body,decodeURIComponent(highlight.textStart),highlight.prefix,highlight.suffix)}(highlight)?highlight:(console.warn("Created highlight cannot be found reliably:",{text:decodeURIComponent(textStart),prefix:prefix?decodeURIComponent(prefix):void 0,suffix:suffix?decodeURIComponent(suffix):void 0,xpath:highlight.xpath}),null)}(mergedRange);if(mergedHighlightData){console.log("Created merged highlight:",{type:overlap.type,content:mergedHighlightData.content});const combinedNotes=Array.from(new Set([...highlight1.notes||[],...highlight2.notes||[]]));return mergedHighlightData.notes=combinedNotes.length>0?combinedNotes:void 0,mergedHighlightData}return console.warn("Failed to create merged highlight data from combined range."),"encompasses"===overlap.type&&highlight1.content.length>highlight2.content.length?highlight1:highlight2}function mergeComplexHighlights(highlight1,highlight2){const element1=getElementByXPath(highlight1.xpath),element2=getElementByXPath(highlight2.xpath);if(!element1||!element2)return console.error("Cannot merge highlights: elements not found"),null;let mergedElement;if(element1.contains(element2))mergedElement=element1;else if(element2.contains(element1))mergedElement=element2;else{const parentCheck1=getParents(element2).includes(element1),parentCheck2=getParents(element1).includes(element2);mergedElement=parentCheck1?element1:parentCheck2?element2:function findCommonAncestor(element1,element2){const parents1=getParents(element1),parents2=getParents(element2);for(const parent of parents1)if(parents2.includes(parent))return parent;return document.body}(element1,element2)}const mergedType="complex"===highlight1.type||"complex"===highlight2.type||mergedElement!==element1||mergedElement!==element2?"complex":"element",combinedNotes=Array.from(new Set([...highlight1.notes||[],...highlight2.notes||[]]));return{xpath:getElementXPath(mergedElement),content:mergedElement.outerHTML,type:mergedType,id:Date.now().toString(),notes:combinedNotes.length>0?combinedNotes:void 0}}function getParents(element){const parents=[];let currentElement=element;for(;currentElement&&currentElement!==document.body;)parents.unshift(currentElement),currentElement=currentElement.parentElement;return parents.unshift(document.body),parents}function saveHighlights(){const url=window.location.href;if(highlights.length>0){const data={highlights,url};utils_browser_polyfill.storage.local.get("highlights").then((result=>{const allHighlights=result.highlights||{};allHighlights[url]=data,utils_browser_polyfill.storage.local.set({highlights:allHighlights}).then((()=>{notifyHighlightsUpdated()}))}))}else utils_browser_polyfill.storage.local.get("highlights").then((result=>{const allHighlights=result.highlights||{};delete allHighlights[url],utils_browser_polyfill.storage.local.set({highlights:allHighlights}).then((()=>{notifyHighlightsUpdated()}))}))}function applyHighlights(){try{const isInReader=document.documentElement.classList.contains("obsidian-reader-active");let searchContainer;if(searchContainer=isInReader&&document.querySelector(".obsidian-reader-content article")||document.body,!searchContainer)return void console.warn("Could not find container for highlights");isApplyingHighlights=!0,removeExistingHighlights(),highlights.forEach(((highlight,index)=>{try{let targetElement=null;targetElement="fragment"===highlight.type?searchContainer:getElementByXPath(highlight.xpath),targetElement?planHighlightOverlayRects(searchContainer,targetElement,highlight,index):"fragment"!==highlight.type&&console.warn(`Element not found for XPath: ${highlight.xpath}`)}catch(error){console.error("Error applying highlight:",error,highlight)}})),updateHighlightListeners(),isApplyingHighlights=!1}catch(error){console.error("Error in applyHighlights:",error),isApplyingHighlights=!1}}function notifyHighlightsUpdated(){utils_browser_polyfill.runtime.sendMessage({action:"highlightsUpdated"})}function getHighlights(){return highlights.map((h=>h.content))}function loadHighlights(){return highlighter_awaiter(this,void 0,void 0,(function*(){const url=window.location.href,storedData=((yield utils_browser_polyfill.storage.local.get("highlights")).highlights||{})[url];storedData&&Array.isArray(storedData.highlights)&&storedData.highlights.length>0?(highlights=storedData.highlights,yield loadSettings(),generalSettings.alwaysShowHighlights&&(applyHighlights(),document.body.classList.add("obsidian-highlighter-always-show")),notifyHighlightsUpdated()):(highlights=[],notifyHighlightsUpdated()),lastAppliedHighlights=JSON.stringify(highlights)}))}function clearHighlights(){const url=window.location.href,oldHighlights=[...highlights];utils_browser_polyfill.storage.local.get("highlights").then((result=>{const allHighlights=result.highlights||{};delete allHighlights[url],utils_browser_polyfill.storage.local.set({highlights:allHighlights}).then((()=>{highlights=[],removeExistingHighlights(),console.log("Highlights cleared for:",url),utils_browser_polyfill.runtime.sendMessage({action:"highlightsCleared"}),notifyHighlightsUpdated(),updateHighlighterMenu(),addToHistory("remove",oldHighlights,[])}))}))}function updateHighlighterMenu(){removeHighlighterMenu(),createHighlighterMenu()}function handleKeyDown(event){"Escape"===event.key&&document.body.classList.contains("obsidian-highlighter-active")?exitHighlighterMode():(event.metaKey||event.ctrlKey)&&"z"===event.key&&(event.preventDefault(),event.shiftKey?redo():undo())}function exitHighlighterMode(){console.log("Exiting highlighter mode"),toggleHighlighterMenu(!1),utils_browser_polyfill.runtime.sendMessage({action:"setHighlighterMode",isActive:!1}),utils_browser_polyfill.storage.local.set({isHighlighterMode:!1}),generalSettings.alwaysShowHighlights||removeExistingHighlights()}function addToHistory(type,oldHighlights,newHighlights){highlightHistory.push({type,oldHighlights,newHighlights}),highlightHistory.length>MAX_HISTORY_LENGTH&&highlightHistory.shift(),redoHistory=[],updateUndoRedoButtons()}function highlighter_mapNormalizedPositionToOriginal(originalText,normalizedText,normalizedPosition){let originalPos=0,normalizedPos=0,originalLen=originalText.length,normalizedLen=normalizedText.length;if(normalizedPosition<=0)return 0;if(normalizedPosition>=normalizedLen)return originalLen;for(;normalizedPos<normalizedPosition&&originalPos<originalLen;){let originalChar=originalText[originalPos],normalizedChar=normalizedText[normalizedPos];if(originalChar.toLowerCase()===normalizedChar.toLowerCase())originalPos++,normalizedPos++;else if(/\s/.test(originalChar))normalizedPos>0&&/\s/.test(normalizedText[normalizedPos-1])?originalPos++:/\s/.test(normalizedChar)?(originalPos++,normalizedPos++):originalPos++;else{if(originalChar===normalizedChar){console.warn("Normalization mapping encountered unexpected state.");break}originalPos++}}for(;originalPos<originalLen&&/\s/.test(originalText[originalPos]);)originalPos++;return originalPos}function handleCopyAllHighlightsLink(){return highlighter_awaiter(this,void 0,void 0,(function*(){const fragmentHighlights=highlights.filter((h=>"fragment"===h.type));if(0===fragmentHighlights.length)return void console.log("No fragment highlights to copy.");const fullUrl=`${window.location.href.split("#")[0]}#:~:${fragmentHighlights.map(generateTextFragmentString).join("&")}`;try{yield navigator.clipboard.writeText(fullUrl);const copyButton=document.getElementById("obsidian-copy-all-links");if(copyButton){const originalIcon=copyButton.innerHTML;copyButton.innerHTML='\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg>\n\t\t\t',copyButton.classList.add("copied"),setTimeout((()=>{copyButton.innerHTML=originalIcon,copyButton.classList.remove("copied")}),2e3)}}catch(error){console.error("Error copying all highlight links:",error)}}))}var dist=__webpack_require__("./node_modules/defuddle/dist/index.js"),dist_default=__webpack_require__.n(dist);function getDomain(url){try{const hostname=new URL(url).hostname;if("localhost"===hostname||"127.0.0.1"===hostname||hostname.match(/^(\d{1,3}\.){3}\d{1,3}$/))return hostname;const hostParts=hostname.split(".");return hostParts.length>2&&hostParts.slice(-2).join(".").match(/^(co|com|org|net|edu|gov|mil)\.[a-z]{2}$/)?hostParts.slice(-3).join("."):hostParts.slice(-2).join(".")}catch(error){return console.warn("Invalid URL:",url),""}}var content_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};!function(){if(window.hasOwnProperty("obsidianHighlighterInitialized"))return;window.obsidianHighlighterInitialized=!0;let isHighlighterMode=!1;function updateHasHighlights(){const hasHighlights=getHighlights().length>0;browser_polyfill_min_default().runtime.sendMessage({action:"updateHasHighlights",hasHighlights})}browser_polyfill_min_default().runtime.sendMessage({action:"contentScriptLoaded"}),browser_polyfill_min_default().runtime.onMessage.addListener(((request,sender,sendResponse)=>{if("ping"===request.action)return sendResponse({}),!0})),browser_polyfill_min_default().runtime.onMessage.addListener(((request,sender,sendResponse)=>{var _a;if("getPageContent"===request.action){let selectedHtml="";const selection=window.getSelection();if(selection&&selection.rangeCount>0){const clonedSelection=selection.getRangeAt(0).cloneContents(),div=document.createElement("div");div.appendChild(clonedSelection),selectedHtml=div.innerHTML}const extractedContent={},defuddled=new(dist_default())(document,{url:document.URL}).parse(),doc=(new DOMParser).parseFromString(document.documentElement.outerHTML,"text/html");doc.querySelectorAll("script, style").forEach((el=>el.remove())),doc.querySelectorAll("*").forEach((el=>el.removeAttribute("style"))),doc.querySelectorAll("[src], [href]").forEach((element=>{["src","href","srcset"].forEach((attr=>{const value=element.getAttribute(attr);if(value)if("srcset"===attr){const newSrcset=value.split(",").map((src=>{const[url,size]=src.trim().split(" ");try{return`${new URL(url,document.baseURI).href}${size?" "+size:""}`}catch(e){return src}})).join(", ");element.setAttribute(attr,newSrcset)}else if(!(value.startsWith("http")||value.startsWith("data:")||value.startsWith("#")||value.startsWith("//")))try{const absoluteUrl=new URL(value,document.baseURI).href;element.setAttribute(attr,absoluteUrl)}catch(e){console.warn(`Failed to process ${attr} URL:`,value)}}))}));const cleanedHtml=doc.documentElement.outerHTML,response={author:defuddled.author,content:defuddled.content,description:defuddled.description,domain:getDomain(document.URL),extractedContent,favicon:defuddled.favicon,fullHtml:cleanedHtml,highlights:getHighlights(),image:defuddled.image,parseTime:defuddled.parseTime,published:defuddled.published,schemaOrgData:defuddled.schemaOrgData,selectedHtml,site:defuddled.site,title:defuddled.title,wordCount:defuddled.wordCount};sendResponse(response)}else if("extractContent"===request.action){const content=function extractContentBySelector(selector,attribute,extractHtml=!1){var _a;try{const elements=document.querySelectorAll(selector);return elements.length>1?Array.from(elements).map((el=>{var _a;return attribute?el.getAttribute(attribute)||"":extractHtml?el.outerHTML:(null===(_a=el.textContent)||void 0===_a?void 0:_a.trim())||""})):1===elements.length?attribute?elements[0].getAttribute(attribute)||"":extractHtml?elements[0].outerHTML:(null===(_a=elements[0].textContent)||void 0===_a?void 0:_a.trim())||"":(console.log(`No elements found for selector: ${selector}`),"")}catch(error){return console.error("Error in extractContentBySelector:",error,{selector,attribute,extractHtml}),""}}(request.selector,request.attribute,request.extractHtml);sendResponse({content})}else{if("paintHighlights"===request.action)return loadHighlights().then((()=>{generalSettings.alwaysShowHighlights&&applyHighlights(),sendResponse({success:!0})})),!0;if("setHighlighterMode"===request.action)return isHighlighterMode=request.isActive,toggleHighlighterMenu(isHighlighterMode),updateHasHighlights(),sendResponse({success:!0}),!0;if("getHighlighterMode"===request.action)return browser_polyfill_min_default().runtime.sendMessage({action:"getHighlighterMode"}).then(sendResponse),!0;if("toggleHighlighter"===request.action)toggleHighlighterMenu(request.isActive),updateHasHighlights(),sendResponse({success:!0});else if("highlightSelection"===request.action){toggleHighlighterMenu(request.isActive);const selection=window.getSelection();selection&&!selection.isCollapsed&&handleTextSelection(selection),updateHasHighlights(),sendResponse({success:!0})}else if("highlightElement"===request.action){if(toggleHighlighterMenu(request.isActive),request.targetElementInfo){const{mediaType,srcUrl,pageUrl}=request.targetElementInfo;let elementToHighlight=null;const urlMatches=(elementSrc,targetSrc)=>{const elementUrl=new URL(elementSrc,pageUrl),targetUrl=new URL(targetSrc,pageUrl);return elementUrl.href===targetUrl.href};if(elementToHighlight=document.querySelector(`${mediaType}[src="${srcUrl}"]`),!elementToHighlight){const relativeSrc=new URL(srcUrl).pathname;elementToHighlight=document.querySelector(`${mediaType}[src="${relativeSrc}"]`)}if(!elementToHighlight){const elements=Array.from(document.getElementsByTagName(mediaType));for(const el of elements)if((el instanceof HTMLImageElement||el instanceof HTMLVideoElement||el instanceof HTMLAudioElement)&&urlMatches(el.src,srcUrl)){elementToHighlight=el;break}}elementToHighlight?(getElementXPath(elementToHighlight),function highlightElement(element,notes){const highlight={xpath:getElementXPath(element),content:element.outerHTML,type:"complex",id:Date.now().toString()};notes&&notes.length>0&&(highlight.notes=notes),addHighlight(highlight)}(elementToHighlight)):console.warn("Could not find element to highlight. Info:",request.targetElementInfo)}updateHasHighlights(),sendResponse({success:!0})}else if("clearHighlights"===request.action)clearHighlights(),updateHasHighlights(),sendResponse({success:!0});else{if("getHighlighterState"===request.action)return browser_polyfill_min_default().runtime.sendMessage({action:"getHighlighterMode"}).then((response=>{sendResponse(response)})).catch((error=>{console.error("Error getting highlighter mode:",error),sendResponse({isActive:!1})})),!0;if("toggleReaderMode"===request.action)return browser_polyfill_min_default().runtime.sendMessage({action:"toggleReaderMode",tabId:null===(_a=sender.tab)||void 0===_a?void 0:_a.id}).then(sendResponse).catch((error=>{console.error("Error toggling reader mode:",error),sendResponse({success:!1,error:error instanceof Error?error.message:"Unknown error"})})),!0}}return!0})),function initializeHighlighter(){content_awaiter(this,void 0,void 0,(function*(){yield loadSettings(),yield loadHighlights(),generalSettings.alwaysShowHighlights&&applyHighlights(),updateHasHighlights()}))}(),window.addEventListener("load",updateHasHighlights),window.addEventListener("beforeunload",(function handlePageUnload(){isHighlighterMode&&(toggleHighlighterMenu(!1),browser_polyfill_min_default().runtime.sendMessage({action:"highlighterModeChanged",isActive:!1}),browser_polyfill_min_default().storage.local.set({isHighlighterMode:!1}))})),document.addEventListener("obsidian-reader-init",(()=>content_awaiter(this,void 0,void 0,(function*(){const button=document.querySelector('[data-action="toggle-highlighter"]');button&&button.addEventListener("click",(e=>content_awaiter(this,void 0,void 0,(function*(){var _a;try{const response=yield browser_polyfill_min_default().runtime.sendMessage({action:"ensureContentScriptLoaded"});let tabId;response&&"object"==typeof response&&(tabId=response.tabId),tabId||(tabId=null===(_a=(yield browser_polyfill_min_default().tabs.query({active:!0,currentWindow:!0}))[0])||void 0===_a?void 0:_a.id),tabId?yield browser_polyfill_min_default().runtime.sendMessage({action:"toggleHighlighterMode",tabId}):console.error("[Content]","Could not determine tab ID")}catch(error){console.error("[Content]","Error in toggle flow:",error)}}))))}))))}()})()})();